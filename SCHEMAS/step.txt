- mongoose 6.5.3 âœ”ï¸ 
   ** trÆ°á»›c kia 5.2.17 cÃ³ 1 high vulnerabilities bá»‹ Snyk nháº¯c, giá» 0 cÃ²n 

- Schema lÃ m cÆ¡ sá»Ÿ cho tá»«ng Model to build data/document shape âœ”ï¸ 
   const mongoose=require('mongoose');
   const xSchema=new mongoose.Schema({

   })
   module.exports = mongoose.model('X', xSchema);

- congty.schema.js âœ”ï¸
- (manually ğŸ˜ chá»§ Ä‘á»™ng táº¡o csdl ngay trÃªn mongodb) create database in mongodb => KhÃ´ng pháº£i cÃ¡ch hay
   => âœ… (khÃ´ng cáº§n, khi cháº¡y mongodb uri sáº½ tá»± tháº¥y tÃªn CSDL vÃ  táº¡o tá»± Ä‘á»™ng) => ğŸ†˜ nháº­n Ä‘á»‹nh sai, tháº¥y tÃªn DB trÃªn mongoUri thÃ¬ khÃ´ng táº¡o CSDL, mÃ  pháº£i táº¡o collection Ä‘áº§u tiÃªn trÆ°á»›c 
   => ğŸ”± Solution? : https://mongoosejs.com/docs/connections.html (to register connections with a dependency injector) => sáº½ chÆ°a cháº¡y Ä‘Æ°á»£c cho tá»›i khi modify má»™t chÃºt
   taoCSDLvaFirstCollection()âœ”ï¸ ğŸ‘‰  NHANVIENQUANLY lÃ  CSDL vÃ  congties lÃ  collection Ä‘áº§u tiÃªnâœ”ï¸
   createNewCongty()âœ”ï¸          ğŸ‘‰  populate dá»¯ liá»‡u vÃ o CSDL NHANVIENQUANLY  âœ”ï¸

- dotenv Ä‘á»ƒ lÆ°u sensitive information 
  ** MONGODB_URI âœ”ï¸
    *** .connect(process.env.MONGODB_URI) //chá»‰ tÃªn database trong MONGODB_URI rá»“i npm start KHÃ”NG giÃºp táº¡o new database trÃªn MongoDb âœ”ï¸
  ** PORT âœ”ï¸

- Ä‘Ã£ schema the shape cho Cong_ty data âœ”ï¸

- "start": "nodemon index.js" âœ”ï¸  (Ä‘á»ƒ giÃºp cháº¡y server vá»›i npm start)

- quanlychinhanh.schema.js âœ”ï¸
- quanlydonvi.schema.js âœ”ï¸
- nhanvien.schema.js âœ”ï¸

- routes 
   ** app.use('/',visitorRoutes); --> âœ”ï¸ http://localhost:3002/
   ** http://localhost:3002/admin/login âœ”ï¸
   ** http://localhost:3002/employee/login âœ”ï¸
   ** http://localhost:3002/quanlychinhanh/login âœ”ï¸

- MVC controller actions: 
   âœ… visitor
      âš½ï¸ getIndex âœ”ï¸ ğŸ‘‰ style cho trang nÃ y  https://youtu.be/3hZuBesdJS8

   âœ… nhanvien
      âš½ï¸ menu Login
         *** mÃ n hÃ¬nh Login ğŸ‘‰  https://youtu.be/3hZuBesdJS8
      âš½ï¸ menu Register âœ”ï¸
         *** ğŸ˜¨ Email/Username
         *** flash message thÃ´ng bÃ¡o Ä‘Ã£ Ä‘Äƒng kÃ½ thÃ nh cÃ´ng, redirect tá»›i trang login
      âš½ï¸ Sau khi nhanvien log in SUCCESSFULLY, lÆ°u session cá»§a nhanvien vÃ o MongoStore  
         *** https://expressjs.com/en/resources/middleware/session.html
            **** Ä‘á»ƒ tÃ­nh toÃ¡n view counter 
            **** Ä‘á»ƒ khi user login, cÃ³ thá»ƒ keep a user login session 
      âš½ï¸ menu Personal Profile ğŸ‘‰ xem , sá»­a âœ”ï¸
         *** vá»›i Xem, xem dá»± Ã¡n máº«u Ä‘á»ƒ dÃ¹ng web API controller láº¥y dá»¯ liá»‡u vá» vÃ  xá»­ lÃ½ hiá»ƒn thá»‹
              ğŸ‘‰ lÃ m viá»‡c vá»›i thÆ° má»¥c webAPI Ä‘ang ráº£nh 
      âš½ï¸ menu Employee Covid 19  âœ”ï¸
      âš½ï¸ menu Statistics ğŸ‘‰ xem giá» lÃ m, lÆ°Æ¡ng âœ”ï¸
      âš½ï¸ menu Äiá»ƒm danh giá» lÃ m vÃ  káº¿t thÃºc âœ”ï¸
      âš½ï¸ Cáº§n cÃ³ collection nhanviens Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin thÃ´i (khÃ´ng thÃªm cÃ³ thÃ´ng tin khÃ¡c nhÆ° annualYearLeave, updatedAt .... vÃ o Ä‘Ã¢y)
            module.exports = nhanvienSchema âœ”ï¸
      âš½ï¸ VÃ  cÃ³ collection cÃ³ reference nhanvienId Ä‘á»ƒ Ä‘iá»ƒm danh giá» vÃ o giá» ra --> Ä‘á»‘i tÆ°á»£ng DiemDanh nÃ y sáº½ Ä‘Æ°á»£c in ra JSON gá»­i cho nhÃ  quáº£n lÃ½ xem duyá»‡t
            diemdanh.nhanvien.schema.js âœ”ï¸

      âš½ï¸ Khi register chá»‰ cho nhanvien Ä‘Äƒng kÃ½ username , password thÃ´i (cÃ¡c fields cÃ²n láº¡i cá»§a schema khÃ´ng cáº§n required:true nghÄ©a lÃ  khÃ´ng báº¯t buá»™c Ä‘iá»n. Khi login thÃ nh cÃ´ng thÃ¬ bá»• sung Profile vÃ o CSDL (save cáº­p nháº­t thÃªm thÃ´ng tin bÃªn cáº¡nh username vÃ  password )) 
         => what if thá»±c hiá»‡n liÃªn tiáº¿p 2 láº§n POST form ?? Khi Ä‘Ã³ username password xong thÃ¬ tá»›i form thÃ´ng tin cÃ¡ nhÃ¢n => Táº¥t cáº£ thÃ´ng tin lÆ°u thÃ nh cÃ´ng vÃ o CSDL sáº½ tá»›i 1 trang Login 
         => Muá»‘n lÆ°u thÃ nh cÃ´ng liÃªn tiáº¿p 2 post form thÃ¬ cáº§n req.session (session() sáº½ táº¡o 1 cookie mÃ¡y khÃ¡ch ) chá»© khÃ´ng dÃ¹ng req.body vÃ¬ tá»›i trang sau sáº½ lost req.body.username vÃ  req.body.password
   
   https://express-validator.github.io/docs/ âœ”ï¸
   https://express-validator.github.io/docs/sanitization-chain-api.html âœ”ï¸
   const { check, body } = require('express-validator/check');âœ”ï¸

   âœ… admin
         => https://stackoverflow.com/questions/66120484/what-is-the-purpose-of-storing-the-session-in-a-session-store-like-mongo-store 
            *** Well, I use it for analytics. Like how many sessions we had today. Or yesterday. Or for the year.
            *** BUT if you donâ€™t use something like redis of mongo, all your MEMORY will get eaten up. Express-session isnâ€™t built for production environments.
            *** Yeah, so when you use express-session or another MEMORY bases session manager, everytime the server restarts, the memory is cleared
            *** cÃ¢u há»i lÃ  req.session xuáº¥t hiá»‡n khi nÃ o? Sau khi cháº¡y session() cá»§a express-session hay sau khi store:store lÆ°u session vÃ´ MongoDB ? 
               **** https://stackoverflow.com/questions/68841518/storing-sessions-with-express-session-connect-mongo-and-mongoose
               **** cÃ³ láº½ lÃ  sau khi req mang cookie cháº£y qua session() sáº½ táº¡o req.session => https://stackoverflow.com/questions/51731771/node-js-how-to-save-a-users-shopping-cart-in-express-session
               app.post('/api/cart', (req, res) => { 
                     âœ”ï¸ var cart = req.body; 
                      req.session.cart = cart;    //gÃ¡n thÃ´ng tin cho session
                      req.session.save(err, sessionCart) =>{    //lÆ°u session vÃ o MongoStore with save()
                      console.log(sessionCart); 
                      if(err){ throw err; }       
                      res.json(req.session.cart);
               **** Náº¿u váº­y thÃ¬ truy cáº­p session trong MongoStore Ä‘á»ƒ lÃ m gi khi nÃ o cáº§n  
  
            ***  So, if it is in the database, the database isn't cleared on server reset. if memory is cleared, the user will be logged out. This will not happen if the cookies are stored in the database.
            => what is purpose of express-session trong development (khÃ´ng pháº£i production) (khÃ´ng nÃ³i tá»›i lÆ°u session trong MongoStore)
                **** cÃ³ pháº£i chá»‰ Ä‘á»ƒ táº¡o cookie thÃ´i. Khi server restart thÃ¬ háº¿t session, sáº½ bá»‹ loggout ??
            *** https://viblo.asia/p/tuong-tu-nhu-session-trong-node-js-tu-php-sang-node-js-V3m5WyqbZO7
            *** session stores
               **** MemoryStore vs MongoStore
               ğŸ‘‰   LÃ m sao lÆ°u cáº£ 2 nÆ¡i? 
                  ***** plan 1: biáº¿n isLoggedIn vÃ  user Ä‘Æ°á»£c lÆ°u vÃ o trong MongStore sau khi login thÃ nh cÃ´ng 
                  ***** plan 2: sau má»—i vÃ²ng login sáº½ regenerate sessin // regenerate the session, which is good practice to help guard against forms of session fixation
                        ğŸ‘‰ https://expressjs.com/en/resources/middleware/session.html
               **** CÃCH access má»—i loáº¡i?
                  ***** https://stackoverflow.com/questions/19889552/how-to-access-express-session-memorystore-via-socket-io-objects
      ** Planing 
         *** táº£i express-session âœ”ï¸
            **** cháº¡y app.use(session(  chÆ°a cÃ³ store nÃ o Ä‘Äƒng kÃ½ trong Ä‘Ã¢y thÃ¬ Express's session store máº·c Ä‘á»‹nh chÃ­nh lÃ  MemoryStore lÆ°u trÃªn RAM ))   âœ”ï¸
               ***** khi req má»›i nÃ o cháº£y qua (cÃ³ hoáº·c khÃ´ng mang chuá»—i cookie do browser Ä‘Ã­nh kÃ¨m) thÃ¬ táº¥t nhiÃªn lÃ  nháº­n session. LÃºc nÃ y trÃªn MongoDB khÃ´ng lÆ°u session nÃ o háº¿t, nghÄ©a lÃ  session hiá»‡n chá»‰ á»Ÿ Backend stack, khÃ´ng cÃ³ á»Ÿ Database stack
            **** vÃ¬ sao má»—i req má»›i tá»›i, mÃ£ urlencoded cookie khÃ´ng Ä‘á»•i nhÆ°ng sessionID luÃ´n Ä‘á»•i? 
               ğŸ‘‰ do req.session khÃ´ng bá»n (data persistence), bá»‹ há»§y má»—i khi F5 aka req má»›i táº¡o thÃ nh. Do Ä‘Ã³ req má»›i thÃ¬ á»©ng vá»›i sessionID má»›i 
            **** truy cáº­p req.sessionID lÆ°u  trÃªn memory RAM cá»§a mÃ¡y chá»§ (vá»›i MemoryStore?), sáº½ dáº«n tá»›i tá»‘n RAM vÃ  khi mÃ¡y chá»§ máº¥t Ä‘iá»‡n thÃ¬ session máº¥t theo. Do Ä‘Ã³ muá»‘n lÃ¢u bá»n (persist, trong NodeJS cÃ³ module Node-persist) pháº£i lÆ°u session trÃªn MongoDB (MongoStore)  âœ”ï¸
           
         *** táº£i cookie-parser âœ”ï¸
            **** Ä‘á»ƒ láº¥y giÃ¡ trá»‹ cookie trong mÃ¡y khÃ¡ch âœ”ï¸
            **** console.log("req cookie:\n",req.cookies); //ok, nhÆ°ng req.cookies lÃ  dÄ© nhiÃªn cÃ³, Ä‘Ã¢u cáº§n cookieParser?
               ***** thá»­ secret:'secret to sign cookie' trong session rá»“i 
                  // Cookies that have been signed
                  console.log('Signed Cookies: ', req.signedCookies)

      ** cho admin register vá»›i admin user name vÃ  password trong .env  âœ”ï¸
         *** router.post('/register', userInput express validator , adminController.postSignup) âœ”ï¸
         *** cÃ¡c validator error sáº½ hiá»ƒn thá»‹ á»Ÿ vá»‹ trÃ­ nÃ o trong view , view /register hay view /login ???
            **** Náº¿u cÃ³ error thÃ¬ style há»™p message tháº¿ nÃ o? 
            <!--cáº§n style báº£ng div#directMessage, dÃ¹ng link cá»§a link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" ğŸ‘‰ class="w3-panel w3-pale-green"-->
               <% if (errorMessage) { %>
                âœ”ï¸   <div id="directMessage" class="w3-panel w3-pale-green user-message user-message--error"><%= errorMessage %></div>
               <% } %>

      ** Táº¡i Assignment_phan5 sáº½ style cho 3 pháº§n trang web head,body,footer
         *** how to add images to .txt file? https://www.computerhope.com/issues/ch000740.htm
         *** form hiá»‡n táº¡i quÃ¡ lá»›n bá» ngang, lÃ m trÃ n qua pháº£i ra ngoÃ i mÃ n hÃ¬nh mobile first
            **** https://www.w3schools.com/w3css/w3css_input.asp
            **** Káº¿t quáº£: âœ”ï¸ nhanvien controller dÃ¹ng login_mobile.ejs cÃ³ W3.CSS thÃ¬ Ä‘Ã¡p á»©ng mobile first 
                          âŒ admin controller dÃ¹ng login.ejs (khÃ´ng cÃ³ W3.CSS thÃ¬ khÃ´ng Ä‘Ã¡p á»©ng mobile first)
            **** login_mobile_w3css.ejs  âœ”ï¸
            **** login_mobile_bootstrap5.ejs  âœ”ï¸
            **** login_mobile_maximillian âŒ
            **** register --> w3css mobile first âœ”ï¸

      ** Táº¡i Assignment2_phan6
         *** chÃº Ã½ CSS , dÃ¹ng Google Color Picker láº¥y mÃ u Ä‘áº¹p cá»§a cÃ¡c website khÃ¡c cho vÃ o Snippets âœ”ï¸
         *** Ä‘á»™ Æ°u tiÃªn inline CSS  trong má»™t tag ; Internal CSS ; External CSS  âœ”ï¸
         *** Tuy nhiÃªn Footer cÃ²n to quÃ¡ ğŸ™ˆ, lÃ½ do lÃ  khi mÃ n hÃ¬nh iphone4 Footer nhÃ¬n ráº¥t gá»n, cÃ²n MaxHub thÃ¬ footer to  âœ”ï¸
      
      ** Táº¡i Assignment2_phan7 âœ”ï¸
         *** chá»‰nh láº¡i tá»•ng thá»ƒ website layout:  header vÃ  footer cho Ä‘á»u https://www.w3schools.com/w3css/tryit.asp?filename=tryw3css_default_intro
            **** problem hiá»‡n táº¡i vá»›i desktop screen and mobile first ? 
            **** https://www.w3schools.com/w3css/w3css_mobile.asp

      ** Assignemnt2_phan11   âœ”ï¸
         ** sáº¯p xáº¿p láº¡i thá»© tá»± trong index.js so vá»›i phan10
         
         ** await CongTy.countDocuments váº«n cÃ³ váº¥n Ä‘á». Xem láº¡i lÃ½ thuyáº¿t
             *** https://www.geeksforgeeks.org/mongoose-countdocuments-function/

      ** Assignment2_phan12 âœ”ï¸
         ** Náº¿u cÃ³ promise thÃ¬ khÃ´ng dÃ¹ng callback: bá» callback function (err, count)  vÃ  dÃ¹ng then().catch()

      ** Assignment2_phan13
         ** save dá»¯ liá»‡u admin vÃ o MongoDB  âœ”ï¸
            *** â“ vá»›i password Ä‘Ã£ nháº­p manu thÃ¬ lÃ m sao Ã¡p dá»¥ng bcryptjs trÃªn CSDL hÃ ng loáº¡t báº£ng ?? 
            *** ğŸ’¡(Python) https://www.geeksforgeeks.org/hashing-passwords-in-python-with-bcrypt/
            *** ğŸ’¡ (PHP) https://www.geeksforgeeks.org/how-to-use-bcrypt-for-hashing-passwords-in-php/
            *** (Nodejs) bcrypt hash password and compare passwords synchronously
               **** (LÃ½ thuyáº¿t) https://www.freecodecamp.org/learn/information-security/information-security-with-helmetjs/understand-bcrypt-hashes
               **** Hint 1: Add bcrypt to your project as a dependency.
               **** Hint 2: After you add it, you need to require it in the server file.
            *** (Nodejs) (Implement bcrypt) https://www.geeksforgeeks.org/password-encryption-in-node-js-using-bcryptjs-module/
               **** táº£i npm install bcryptjs --save âœ”ï¸

         ** save dá»¯ liá»‡u nhÃ¢n viÃªn 
            *** NV pháº£i nháº­p cáº£ danh sÃ¡ch ngoáº¡i ngá»¯, nÃªn pháº£i manually nháº­p vÃ o CSDL âœ”ï¸
            *** ban Ä‘áº§u nháº­p kháº©u nhanvien.model() vÃ o app.js Ä‘á»ƒ táº¡o báº£ng sáºµn trÃªn CSDL
               **** const nhanvienMongooseModel=require('./MODELS/nhanvien.model'); âœ”ï¸ //ok, Ä‘Æ°á»£c pháº§n má»m Ä‘á»c qua vÃ  táº¡o báº£ng rá»—ng nhanviens 
               **** Insert Document >> nháº­p tay dá»¯ liá»‡u cho nhÃ¢n viÃªn 
                  ***** lÃ m sao copy paste cho nhanh? https://studio3t.com/knowledge-base/articles/copy-paste-mongodb-documents/
                  ***** Note: Má»©c lÆ°Æ¡ng 10202093  lÃ  kiá»ƒu Int32 âœ”ï¸
         ** Ä‘Ã£ manually nháº­p nhanviens, admins, quanlychinhanhs, congties âœ”ï¸
         ** nhanviens --> thÃªm startDate vÃ  annualLeave, Image 
         ** nhanvien postLogin
            *** https://www.geeksforgeeks.org/login-form-using-node-js-and-mongodb/
         ** const app = express(); //Security matters! 
            *** Snyk security recommendation: Consider using csurf middleware for your Express app to protect against CSRF attacks (khÃ´ng pháº£i csurf attacks)
            *** Snyk: exposed used framework to potential attackers, consider using Helmet middleware to disable the X-Powered-By header for your express app
            *** ğŸ’¡ https://www.geeksforgeeks.org/implementing-csurf-middleware-in-node-js/   
               **** táº£i  ğŸ›¡ npm install csurf --save âœ”ï¸ 
            *** ğŸ’¡ https://www.geeksforgeeks.org/node-js-securing-apps-with-helmet-js/    ; https://www.veracode.com/blog/secure-development/fasten-your-helmetjs-part-1-securing-your-express-http-headers
               **** táº£i  ğŸ›¡ helmet.js module: npm install helmet --save âœ”ï¸ 
               **** tuy nhiÃªn res headers cÃ³ TLS security protection set by helmet
               **** https://social.technet.microsoft.com/Forums/sharepoint/en-US/832e580d-dbdd-4f0f-9d38-26a6b1d11291/cant-connect-securely-to-the-page-this-might-be-beacuse-the-site-uses-outdated-or-unsafe-tls
               **** https://stackoverflow.com/questions/61427858/tls-connection-error-this-might-be-because-the-site-uses-outdated-or-unsafe-tls
         
      ** Assignment2_phan14
         *** bá» helmet vÃ¬ website khÃ´ng hoáº¡t Ä‘á»™ng  (lÃ m localhost:3002 vá»›i initiator lÃ  '/' index Ä‘Ã£ bá»‹ blocked vÃ¬ vi pháº¡m CSP Content Security Policy) : npm uninstall helmet âœ”ï¸
            **** NÃ³i chung, helmet can secure your Express app 
            **** Solution: Ä‘á»•i 3002 thÃ nh port 3005 âœ”ï¸

         *** app.disable('x-powered-by') âœ”ï¸  (nghiÃªn cá»©u helmet sau)
            **** https://stackoverflow.com/questions/61364808/expressjs-disabling-x-powered-by-header

         *** app.use(helmet({
                 crossOriginResourcePolicy: false
               }));
            //chá»‰ Ä‘á»ƒ giáº£i quyáº¿t https://stackoverflow.com/questions/70752770/helmet-express-err-blocked-by-response-notsameorigin-200
         *** Network khÃ´ng tháº¥y route gÃ¬ háº¿t --> doc + bá» háº¿t chá»n nhÆ° "block 3rd cookie" âœ”ï¸
         *** https://stackoverflow.com/questions/37935657/refused-to-load-the-image-because-it-violates-content-securtiy-policy-cordova
         *** ğŸ’¢ cÃ³ cÃ¡i nÃ y rá»“i trá»Ÿ láº¡i Helmet bá»‹ bÃ¡o lá»—i ná»¯a, thÃ¬ bá» helmet vá»›i meta nÃ y thÃ¬ trá»Ÿ láº¡i 
             **** <meta http-equiv="Content-Security-Policy" content="script-src 'self' http://localhost:3002 https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js  https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js 'unsafe-inline' 'unsafe-eval'; ">
    
      ** Assignment2_phan15
         *** login vá»›i nhanvien âœ”ï¸
            **** https://stackoverflow.com/questions/31549857/mongoose-what-does-the-exec-function-do
            **** https://stackoverflow.com/questions/67608299/typeerror-req-next-is-not-a-function-node-js
            **** https://stackoverflow.com/questions/43702840/node-js-req-next-is-not-a-function
            **** https://www.appsloveworld.com/nodejs/100/46/typeerror-req-next-is-not-a-function

         *** náº¿u cÃ³ validation error thÃ¬ thá»±c hiá»‡n POST req tá»›i /nhanvien/login nhÆ°ng re-render láº¡i trang âœ”ï¸
            **** Ä‘á»“ng thá»i cho biáº¿t errorMessage lÃ  gÃ¬ âœ”ï¸
                 'Password has at least 4 characters, please'
         *** login tháº¥t báº¡i
            **** sai so trÃ¹ng máº­t kháº©u
            **** res.redirect('/login'); 
         *** login thÃ nh cÃ´ng?
            **** Ä‘áº·t req.session.user
            **** res.redirect('/')
         *** cÃ³ res 2 láº§n vÃ  bÃ¡o lá»—i ğŸ TypeError: req.next is not a function 

      ** Assignment2_phan16
         *** sá»­a láº¡i lá»—i cá»§a phan15  â“
         *** Problem lÃ  res gá»­i cho client trÆ°á»›c khi findOne hoÃ n táº¥t , do Ä‘Ã³ res cá»§a findOne khÃ´ng thá»±c hiá»‡n Ä‘Æ°á»£c vÃ  bÃ¡o lá»—i 2 láº§n res headers sent to client  âœ”ï¸
         *** Problem khÃ¡c lÃ  1 admin Ä‘Æ°á»£c táº¡o nhiá»u láº§n theo req âœ”ï¸

      ** Assignment2_17
         *** Sá»­a 2 láº§n req headers sent âœ”ï¸
         *** Sá»­a 1 admin Ä‘Æ°á»£c táº¡o nhiá»u láº§n theo req  âœ”ï¸
            **** viá»‡c register admin chÆ°a cÃ³ Ä‘iá»ƒm cháº·n, nÃªn cÃ³ thá»ƒ bá»‹ táº¡o nhiá»u admin trÃ¹ng nhau
         *** https://www.tutorialspoint.com/expressjs/expressjs_sessions.htm
            **** ğŸ’¢ Problem is HTTP is stateless . ğŸ‘‰ Váº­y liÃªn quan cÃ¡ch nÃ o giÃºp má»i req khÃ¡c nhau Ä‘á»u truy cáº­p MemoryStore Ä‘á»ƒ láº¥y dá»¯ liá»‡u
         
         *** quáº£n lÃ½ LOGIN SESSION
            **** https://www.tutorialspoint.com/expressjs/expressjs_sessions.htm#s
            **** https://codeforgeek.com/manage-session-using-node-js-express-4/

            **** ğŸ‘‰ táº¡o is-auth middleware Ä‘á»ƒ ngÆ°á»i chÆ°a login thÃ¬ khÃ´ng tá»›i link Ä‘Æ°á»£c (nháº¥n nÃºt hay URL typing), cÃ²n ngÆ°á»i login thÃ¬ vÃ o Ä‘Æ°á»£c
            
            **** ğŸ‘‰ báº¯t Ä‘áº§u xÃ³a thá»­ nghiá»‡m cÅ© trÃªn MemoryStore thÃ¬ sáº½ lÃ  uninitialized session (lÃ½ do lÃ  Ä‘Ã£ configure saveUninitialized: false? KhÃ´ng liÃªn quan vÃ¬ cÃ¡i nÃ y liÃªn quan session entry trÃªn database?? )
            **** ğŸ‘‰ táº¡o initialized session báº±ng cÃ¡ch gÃ¡n biáº¿n ngay khi login nhanvien thÃ nh cÃ´ng

            **** ğŸ§¬ login session ğŸ§¬ cá»§a nhÃ¢n viÃªn 
               ***** login thÃ nh cÃ´ng Ä‘i tá»›i Home âœ”ï¸ + msg "Ä‘Äƒng nháº­p thÃ nh cÃ´ng" âœ”ï¸ + cÃ³ nÃºt Ä‘Äƒng xuáº¥t sau khi login thÃ nh cÃ´ng âœ”ï¸ 
               ***** res.redirect('/admin/products'); //the point is: CÃ³ cáº§n máº£ng products Ä‘á»ƒ gá»­i cho view 'admin/products' khÃ´ng?? KhÃ´ng vÃ¬ Ä‘ang yÃªu cáº§u client gá»i http://localhost:3000/admin/add-product Ä‘Æ°á»£c xá»­ lÃ½ logic bá»Ÿi exports.getProducts controller action , which send server information 'products' to view  âœ”ï¸
               ***** khi chá»n Employee Ä‘á»ƒ tá»›i trang /nhanvien/login, nÆ¡i nÃ y váº«n hiá»‡n cÃ¡c menu cho nhÃ¢n viÃªn (hay váº«n cho nháº­p GET req trÃªn search bar) nhÆ°ng chá»‰ cÃ³ nhÃ¢n viÃªn Ä‘Ã£ login thÃ nh cÃ´ng má»›i Ä‘Æ°á»£c endpoint handler xá»­ lÃ½
                 => middleware whether-auth-or-not.js âœ”ï¸
                 => muá»‘n váº­y cáº§n táº¡o biáº¿n session chá»©a user ngay sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng âœ”ï¸. 
                 => Sau khi cÃ³ req.session.user thÃ¬ cáº§n track user ngay tá»« khi req láº§n Ä‘áº§u cháº£y vÃ o app ğŸ‘‰ Do Ä‘Ã³ gáº¯n user vÃ o req má»›i tá»›i (req.user) lÃ  Ä‘iá»u cáº§n lÃ m ğŸ‘‰ cáº§n check xem req.session.user bÃªn trong MemoryStore cÃ³ gá»i Ä‘Æ°á»£c Mongoose magic methods hay khÃ´ng  âœ”ï¸
               ***** Káº¿t quáº£ lÃ :

               req.session.user.findOne({Mat_khau:'NV_1',Ten_Dang_nhap:'NV_1'})
                            .then(user=>{
                                console.log("Káº¿t quáº£ thÃ­ nghiá»‡m req.session.user trong MemoryStore cÃ³ thá»±c hiá»‡n Mongoose magic methods Ä‘Æ°á»£c hay khÃ´ng: ",user);
                                //ğŸ’ undefined. Err, we detected an error: TypeError: req.session.user.findOne is not a function âœ”ï¸
                            })
         
              => káº¿t quáº£ trÃªn cho tháº¥y, cho dÃ¹ cÃ¡c req xa láº¡ cÃ¹ng sá»Ÿ há»¯u má»™t logon session cá»§a má»™t mÃ¡y client, thÃ¬ cÅ©ng khÃ´ng gá»i hÃ m Mongoose Ä‘Æ°á»£c  âœ”ï¸
              => trong app.js ngay tá»« Ä‘áº§u npm start pháº£i dÃ¹ng req.user . Hi vá»ng gá»i mongoose model Ä‘Æ°á»£c 

         *** Assignment2_17_phan2
            **** design cho nÃºt Logout âœ”ï¸
            **** sau khi nhanvien login thÃ nh cÃ´ng sáº½ tá»›i Home vÃ  trÃªn thanh dieu_huong cÃ³ nut Logout.   âœ”ï¸
               => khi nháº¥n logout sáº½ há»§y session trong MemoryStore
            **** Cannot GET /nhanvien/logout
               ***** LÃ½ do lÃ  <li><a href="<%=`/${role}`%>/logout"><span class="glyphicon glyphicon-log-in"></span> Log Out</a></li></li>
            **** hoÃ n táº¥t postLogin action 
               ***** dÃ¹ng req.sesion to store asn access session data (on server)
               ***** req.session.user = user   âœ”ï¸
            **** ThÃ­ nghiá»‡m 01: lÃ½ thuyáº¿t connect.sid , req.session chá»©a session cookie setting 
               ***** ğŸ‘‰ http://www.senchalabs.org/connect/session.html#warning
            **** káº¿t quáº£ thÃ­ nghiá»‡m 01: 
               ***** âœ… req.session chá»©a uninitialized session (chá»‰ chá»©a biáº¿n Session cÃ³ cookie máº·c Ä‘á»‹nh) vÃ  
               ***** âœ… sessionStore vá»›i biáº¿n sessions Ä‘ang rá»—ng  
               ***** âœ… chÃºng ta cáº§n session trÃªn server vá»«a giÃºp báº£o máº­t (Ä‘á»ƒ session data trÃªn browser sáº½ bá»‹ Ä‘á»c vÃ  thay Ä‘á»•i) vá»«a giÃºp káº¿t ná»‘i cÃ¡c req má»›i riÃªng ráº» cÃ¹ng thuá»™c má»™t client

         *** Assignment2_18
            **** ThÃ­ nghiá»‡m 02: session.cookie.maxAge null cho tháº¥y no "expires" parameter is set so the cookie becomes a browser-session cookie. When the user closes the âœ”ï¸
browser the cookie (and session) will be removed.
            **** dÃ¹ng req.session.user giÃºp NhanvienModel tÃ¬m ra user vÃ  user nÃ y cÃ³ thá»ƒ thá»±c hiá»‡n cÃ¡c hÃ m mongoose magic 
            **** tham kháº£o store session trÃªn mongodb ğŸ‘‰ https://developer.okta.com/blog/2021/06/07/session-mgmt-node   
            **** cÆ¡ cháº¿ express quáº£n lÃ½ session:  ğŸ‘‰ https://stackoverflow.com/questions/18512461/express-cookiesession-and-mongoose-how-can-i-make-request-session-user-be-a-mon
            **** https://stackoverflow.com/questions/12453249/nodejs-connect-express-how-session-manage-memory
            **** CÃ¢u há»i lÃ  sau khi sessionStore lÆ°u Ä‘Æ°á»£c req.session thÃ¬ req má»›i tiáº¿p theo truy cáº­p Ä‘Æ°á»£c khÃ´ng??
               ***** VD, req táº¡i GET '/' http://localhost:3002/nhanvien/login thÃ nh cÃ´ng login thÃ¬ cÃ³ sessionStorage, váº­y tiáº¿p theo chá»n GET '/' thÃ¬ cÃ³ nháº­n Ä‘Æ°á»£c khÃ´ng ?? 
               ***** tá»•ng quÃ¡t lÃ  cÃ³ req.session.user á»Ÿ postLogin thÃ nh cÃ´ng, váº­y táº¥t cáº£ req má»›i vá» sau á»Ÿ app.js cÃ³ nháº­n Ä‘Æ°á»£c req.session.user khÃ´ng? (ThÃ­ nghiá»‡m 03)

            **** Káº¿t quáº£ thÃ­ nghiá»‡m 02:
               ***** âœ… console.log("req.cookies lÃ : ",req.cookies); //náº¿u browser chÆ°a cÃ³ connect.sid cookie thÃ¬ chá»— nÃ y undefined vá»›i req Ä‘áº§u tiÃªn
               ***** âœ… req.session.country Ä‘Æ°á»£c khai bÃ¡o vÃ  req.session.save() vÃ o sessionStore lÆ°u biáº¿n nÃ y
            **** ThÃ­ nghiá»‡m 03: âœ”ï¸
            **** ThÃ­ nghiá»‡m 04: âœ”ï¸
            **** ThÃ­ nghiá»‡m 05: dá»±a trÃªn cookie maxAge lÃ  null  âœ”ï¸
               ****** case1: Ä‘Ã³ng tab broser, má»Ÿ tab khÃ¡c ğŸ‘‰  cookie khÃ´ng Ä‘á»•i
               ****** case2: Ä‘Ã³ng trÃ¬nh duyá»‡t,má»Ÿ láº¡i     ğŸ‘‰   cookie cÅ© bá»‹ xÃ³a, cookie má»›i Ä‘Æ°á»£c gÃ¡n vÃ o

         *** Kháº¯c phá»¥c báº£o máº­t cá»§a GET req báº±ng URL trÃªn thanh tÃ¬m Kiáº¿m
            **** https://www.smashingmagazine.com/2017/04/secure-web-app-http-headers/
            **** https://owasp.org/www-community/vulnerabilities/Information_exposure_through_query_strings_in_url
            **** GET req ğŸ‘‰	Data is visible to everyone in the URL
               ***** https://reqbin.com/Article/HttpGet
            **** xá»­ lÃ½ hiá»ƒn thá»‹ trÃªn thanh dieu_huong lÃ  chÆ°a Ä‘á»§, vÃ¬ náº¿u biáº¿t route thÃ¬ client váº«n gÃµ GET rql tá»›i endpoint 
               => phÃ­a server cáº§n cháº­n cÃ³ req nÃ o chÆ°a login, redirect nÃ³ trá»Ÿ láº¡i trang login  
            **** Nhanvien
               ***** tráº¡ng thÃ¡i hiá»‡n táº¡i: 
                  ****** Use case 01: nháº¥n nÃºt Login thÃ nh cÃ´ng sáº½ tá»›i trá»±c tiáº¿p http://localhost:3002/nhanvien/view_personal_profile
                  ****** Use case 02: táº¡i trang Home, chÆ°a login mÃ  gÃµ trá»±c tiáº¿p trÃªn thanh tÃ¬m Kiáº¿m ğŸ“¡ http://localhost:3002/nhanvien/view_personal_profile
                        ğŸ‘‰ Cannot read properties of undefined (reading 'Ho_ten') , lÃ½ do lÃ  biáº¿n Ä‘á»‘i tÆ°á»£ng employee lÃ  undefined
                        ğŸ‘‰ LÃ m lá»™ cÃ¡c Ä‘Æ°á»ng dáº«n cá»§a app 
                           Solution 1 ğŸ‘‰ cáº§n error handling vá»›i trang 404 hay 500
                           Solution 2 ğŸ‘‰ cháº­n xá»­ lÃ½ hiá»ƒn thá»‹ view nhanvienProfile báº±ng cÃ¡ch Ä‘á»ƒ (middleware checkLoginStatus.nhanvienIfLoggedIN, náº¿u ghi checkLoginStatus sáº½ bÃ¡o lá»—i yÃªu cáº§u endpoint handler) táº¡i táº§ng router "routes" , ngay trÆ°á»›c endpoint handler postLogin cá»§a nhanvien . Khi Ä‘Ã³ gÃµ URL Ä‘á»ƒ xem nhanvien profile sáº½ bá»‹ redirect vá» trang login âœ”ï¸
               ***** tráº¡ng thÃ¡i lÃºc sau: náº¿u chÆ°a login mÃ  ghi http://localhost:3002/nhanvien/view_personal_profile  sáº½ bá»‹ quay láº¡i http://localhost:3002/nhanvien/login âœ”ï¸


                              
         *** Assignment2_19  
            **** ğŸ’¢ Problem: req.session.user chá»‰ cho biáº¿t data , chá»© khÃ´ng lÆ°u trá»¯ methods Ä‘áº·c biá»‡t lÃ  Moongoose magic methods âœ”ï¸
            **** ğŸ’Š Solution: dÃ¹ng id trong req.session.user._id Ä‘á»ƒ biáº¿t ai Ä‘ang loggedIn, Ä‘á»ƒ nhanvienMongooseModel sá»­ dá»¥ng id nÃ y giÃºp táº¡o a Monggose model with magic methods vÃ  cÃ¡c user-defined methods in schema âœ”ï¸
            **** sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, tá»›i http://localhost:3002/nhanvien/view_personal_profile thÃ¬ cáº§n fetch data cho trang nÃ y using GET request âœ”ï¸
            **** mÃ n hÃ¬nh nháº­p thÃ´ng tin covid cÃ¡ nhÃ¢n Nhanvien
            **** mÃ n hÃ¬nh xem thÃ´ng tin covid cÃ¡ nhÃ¢n Nhanvien
               ***** //GET --> /nhanvien/manHinhNhapCovidNhanvien , sáº½ khÃ´ng cho fetch form náº¿u chÆ°a Ä‘Äƒng nháº­p âœ”ï¸
router.get('/manHinhNhapCovidNhanvien',checkLoginStatus.nhanvienIfLoggedIN,nhanvienController.getFormInputCovidNhanvien); âœ”ï¸
               *****ğŸ’¢ problem: http://localhost:3002/nhanvien/manHinhNhapCovidNhanvien  cannot open the dropdown menu trÃªn dieu_huong
            **** táº¡o Schema cho Tá» khai covid 19 trong thÆ° má»¥c Schema
               ***** https://mongoosejs.com/docs/schematypes.html   âœ”ï¸
               ***** Schema cho tá» Khai Covid nhanvien âœ”ï¸
               ***** userId: user   
                  ****** tham kháº£o: NJS Lab10.18
                  userId: {
                           type: Schema.Types.ObjectId,
                           required: true,
                           ref: 'User'
                     }
                  sau Ä‘Ã³ gÃ¡n userId:user hay userId:req.user   cÅ©ng Ä‘á»u gÃ¡n id thÃ´i 


            **** Model cho tá» Khai Covid nhanvien cho thÆ° má»¥c Model âœ”ï¸
               ***** module.exports=mongoose.model("NHANVIENTOKHAICOVID",require('../SCHEMAS/nhanvienCovid.schema'));
               ğŸ‘‰ nhÆ°ng chÆ°a cÃ³ trÃªn mongodb webAPI
               ğŸ‘‰ Solution: giÃºp táº¡o báº£ng ngay khi khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng táº¡i app.js  âœ”ï¸
               


            **** nháº­p thÃ´ng tin covid cho tá»«ng ngÆ°á»i
               **** nháº­p xong ngÆ°á»i 1 thÃ¬ Log out  âœ”ï¸
               **** Ä‘Äƒng nháº­p ngÆ°á»i 2 rá»“i nháº­p covid cho ngÆ°á»i 2 , rá»“i log out  âœ”ï¸

            **** cho phÃ©p nhÃ¢n viÃªn xem thÃ´ng tin covid cá»§a mÃ¬nh
               **** menu Follow Personal Covid19
                  *****ğŸ’¢ problem: khÃ´ng má»Ÿ Ä‘Æ°á»£c Role Filter

         *** Assignment2_20
            **** cháº¡y trong app.js Ä‘á»ƒ táº¡o collection rá»—ng trong MongoDB 
               ****** tokhaiDiemDanh âœ”ï¸
               ****** tokhaiKetThucLam âœ”ï¸
            **** TÃ¬m solution cho : 
                 ***** menu Follow Personal Covid19 khi má»Ÿ trang, thÃ¬ trang Ä‘Ã­ch cÃ³ Role Filter báº¥m sáº½ redirect req má»›i chá»© khÃ´ng chá»‹u drop down  âœ”ï¸

                 *****ğŸ’¢ problem: khÃ´ng má»Ÿ Ä‘Æ°á»£c Role Filter drop down, vÃ¬ click tá»›i lÃ  nÃ³ cháº¡y a href má»™t req má»›i , trong khi cÃ¡c menu khÃ¡c thÃ¬ khÃ´ng táº¡o req má»›i   âœ”ï¸
                 => (âœ… Thay vÃ¬ báº¥m a hay button Ä‘á»ƒ cÃ³ link drop down, hover sáº½ khÃ´ng táº¡o req má»›i mÃ  váº«n táº¡o drop down) https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover âœ”ï¸
            **** login cho admin 
               **** User case 1: Ten_Dang_nhap: username  , trong Ä‘Ã³ váº¿ pháº£i sai tÃªn input  ğŸ‘‰ mongoose táº¡o js object vá»›i Ten_Dang_nhap lÃ  undefined  âœ”ï¸
               **** User case 2: gÃ¡n input name Ä‘Ãºng cho Schema path nhÆ°ng bá» trá»‘ng 1 trong 2 Ã´ username hay password ğŸ‘‰ ''  (chá»© khÃ´ng cÃ³ undefined) âœ”ï¸
                  ***** VD bá» trá»‘ng Ã´ username 
                  ***** thÃ¬ Mongoose parses thÃ nh admins.findOne({Ten_Dang_nhap:'',Mat_khau:'ADMIN_123456'}); âœ”ï¸
               **** Ä‘Ã£ login thÃ nh cÃ´ng cho admin âœ”ï¸
                  ***** táº¡o collection DIEM_DANH_NHAN_VIEN lÃºc npm start âœ”ï¸
                     ****** TÃªn nhÃ¢n viÃªn 
                     ****** NÆ¡i lÃ m viá»‡c
                     ****** Thá»i gian báº¯t Ä‘áº§u (giá» cá»§a server)  
                        ******* https://stackoverflow.com/questions/45391084/how-to-show-real-time-server-date-and-time-on-nodejs
                        ******* https://stackoverflow.com/questions/24738169/how-can-i-get-the-current-datetime-in-the-format-2014-04-01080000-in-node
                        ******* server time khÃ¡c vá»›i local time: https://stackoverflow.com/questions/45102886/mongodb-query-date-field-with-the-server-time
                        ******* https://stackoverflow.com/questions/42075690/how-to-get-the-server-time-in-the-mean-stack-mongodb-express-angular-node

                        
                        ******* xem xÃ©t trong app.js âœ”ï¸
                           var d = new Date();
                           console.log(d.toJSON().slice(0,19).replace('T',':'));


                  ğŸ‘‰  save(res.redirect(tá»›i trang Diem danh vÃ  tháº¥y trang thÃ¡i "KhÃ´ng lÃ m viá»‡c" chuyá»ƒn thÃ nh "Äang lÃ m viá»‡c"
                  ğŸ    cho phÃ©p táº¡o collection nhiá»u láº§n trong NgÃ y

                  ***** táº¡o collection KET_THUC_PHIEN_LAM_VIEC_CUA_NHAN_VIEN lÃºc npm start âœ”ï¸
                     ****** Sá»‘ giá» Ä‘Ã£ lÃ m hÃ´m nay
                     ****** Danh sÃ¡ch cÃ¡c {luot_bat_dau ; luot_ket_thuc ; noi_lam_viec}
                  ***** sau Ä‘Ã³ náº¿u lÃ m viá»‡c tiáº¿p tá»¥c thÃ¬ save phiáº¿u Ä‘iá»ƒm danh má»›i 
                  ğŸ‘‰  save(res.redirect(tá»›i trang Diem danh vÃ  tháº¥y trang thÃ¡i "Äang lÃ m viá»‡c" chuyá»ƒn thÃ nh "KhÃ´ng lÃ m viá»‡c"
                  ğŸ    cho phÃ©p táº¡o collection nhiá»u láº§n trong NgÃ y
                
                   

            **** Nhan vien
               ***** fetch data GET req: 
                  ****** view: employeeCovidInfo.ejs  âœ”ï¸
                  ****** mÃ n hÃ¬nh Sá»­a thÃ´ng tin nhÃ¢n viÃªn ğŸ‘ˆ
               ***** Ä‘Äƒng kÃ½ checkin vÃ  xem thÃ´ng tin checkin âœ”ï¸


         *** Assignment2_21
            
            **** ğŸ’¢ LÃ m sao cho Dropdown vÃ  chá»n xong sáº½ hiá»‡n trÃªn chá»¯ Dropdown ?
               ***** âœ… Solution: EJS <%= role %> âœ”ï¸
            **** (LÃ m tiÃªu chÃ­ 6) GIÃšP ADMIN LOGIN  vÃ  LOGOUT 
               ***** admin login thÃ nh cÃ´ng, thÃ¬ req.session.admin=admin; xem console.log(req.sessionStore) tháº¥y cÃ³ lÆ°u nguyÃªn anh admin
                  => tiáº¿p theo lÃ m middleware  xÃ©t xem admin cÃ³ loggedin chÆ°a: if(!req.session.admin) âœ”ï¸
                  => náº¿u chÆ°a login cho admin mÃ  gÃµ tháº³ng URL http://localhost:3002/admin/login thÃ¬ bá»‹ tá»›i trang login cá»§a admin âœ”ï¸
               ***** khÃ´ng restart server (vÃ¬ maxAge cá»§a cookie lÃ  null nÃªn sáº½ bá»‹ xÃ³a khi táº¯t server)
                  ****** logout khá»i admin? CHÆ¯A CÃ“ NÃšT loggout cÅ©ng Ä‘Æ°á»£c
                  ****** trong app.js , thÃ¬ MemoryStore váº«n lÆ°u Ä‘á»‘i tÆ°á»£ng admin  âœ”ï¸
                  ****** tiáº¿p tá»¥c GET req Ä‘á»ƒ loggin thÃ nh cÃ´ng cho employee , rá»“i xem    console.log(req.sessionStore) âœ”ï¸
                      => do admin biáº¿t credentials cá»§a mÃ¬nh vÃ  cá»§a employee nÃªn giá» req.sessionStore lÆ°u cáº£ 2 Ä‘á»‘i tÆ°á»£ng user vÃ  admin  âœ”ï¸
               ***** giÃºp admin log out âœ”ï¸
                  ****** sau khi admin login thÃ nh cÃ´ng thÃ¬ tá»›i trang  http://localhost:3002/admin/manageUsers âœ”ï¸
               ***** trong http://localhost:3002/admin/manageUsers
                  ****** táº¡o 2 Bootstrap hay W3CSS form Add Employee vÃ  Add Branch Manager Ä‘á»ƒ giÃºp thÃªm vÃ o CSDL 
                  ****** https://getbootstrap.com/docs/4.1/layout/grid/#auto-layout-columns
                     ******* táº¡o 3 cá»™t báº±ng nhau vá»›i col-sm-4: https://www.w3schools.com/bootstrap/bootstrap_grid_examples.asp âœ”ï¸
                     ******* táº¡o 2 cá»™t báº±ng nhau vá»›i col-sm-6: https://getbootstrap.com/docs/4.1/layout/grid/#auto-layout-columns âœ”ï¸
                     ******* trong div.row thÃ¬ dÃ¹ng text-align:center Ä‘á»ƒ ná»™i dung cÃ¡c cá»™t náº±m giá»¯a  âœ”ï¸
            **** Problem: khi admin Ä‘Ã£ login thÃ¬ nÃºt login bá»‹ giáº¥u Ä‘i, thÃ¬ náº¿u gÃµ http://localhost:3002/admin/login thÃ¬ nÃªn cÃ³ thÃ´ng bÃ¡o: "Báº¡n Ä‘Ã£ loggin"
                  => solution: xá»­ lÃ½ hiá»ƒn thá»‹ thanh dieu_huong.ejs âœ”ï¸ 
            **** giÃºp EJS dynamic hÆ¡n vá»›i Chuoi_HTML nháº­n tá»« controller
               ***** vd 1 biáº¿n ejs cÃ³ thá»ƒ nháº­n Chuoi_HTML_form_W3CSS hay Chuoi_HTML_form_Bootstrap5 âœ”ï¸ 
 
         *** Assignment2_22  
            **** giÃºp QLCN thá»±c hiá»‡n login 
               ***** router.get('/login', quanlychinhanhController.getLogin);  âœ”ï¸
               ***** design trang login cá»§a QLCN âœ”ï¸
               ***** Khi QLCN log in thÃ nh cÃ´ng, giÃºp táº¡o req.session.quanlychinhanh Ä‘á»“ng thá»i render view "index.ejs" dÃ nh riÃªng cho QLCNâœ”ï¸
               ***** giÃºp QLCN log out  âœ”ï¸

         *** Assignment2_23 
               ***** giÃºp admin sau khi login Ä‘Æ°á»£c redirect tá»›i manageUsers, náº¿u sau Ä‘Ã³ admin muá»‘n tá»›i Home menu thÃ¬ sáº½ tá»›i endpoint http://localhost:3002/ sáº½ cÃ³ trang phá»¥c vá»¥ riÃªng vá»›i cÃ¡c menu options 
                  ****** khi chÆ°a login thÃ¬ trang Home lÃ  cá»§a visitor , khi admin Ä‘Ã£ login thÃ¬ trang nÃ y nháº­n cÃ¡c biáº¿n liÃªn quan tá»›i admin âœ”ï¸
                  ****** cáº§n thay Ä‘á»•i sao cho biáº¿n role trong '/' >> getIndex >> index.ejs >> dieu_huong.ejs trá»Ÿ nÃªn dynamic based on specific loggingIn human object !  âœ”ï¸
                  ****** controllers >> visitor.controller.js >> router.get('/', visitorController.getIndex); âœ”ï¸
               => Ä‘Ã£ táº¡o Home page dedicated to a specific LoggedIn human type : loggedIn admin, loggedIn nhanvien, loggedIn quanlychinhanh   âœ”ï¸
  
            **** giÃºp QLCN xem thÃ´ng tin covid cá»§a nhÃ¢n viÃªn mÃ  mÃ¬nh quáº£n lÃ½
               ***** https://www.geeksforgeeks.org/how-to-get-data-from-2-different-collections-of-mongodb-using-node-js/
               ***** menu:ğŸ˜· Employee Covid19
               ***** route 
                  ******  router.get('/thongtinCovidNhanvien',checkLoginStatus.qlcnIfLoggedIn,quanlychinhanhController.getEmployeeInfo);

               ***** endpoint handler (aka app URI response)
                    exports.getEmployeeInfo=(req,res,next)=>{
    
                     }
            

            **** MongoError: findOne() buffering timed out after 10000ms   âœ”ï¸
               ***** ğŸ’¢ LÃ½ do , model() vÃ  cÃ¡c hÃ m mongoose cháº¡y mÃ  khÃ´ng cáº§n cÃ³ mongoose-mongodb connection trÆ°á»›c. VÃ¬ sáº½ Ä‘Æ°á»£c cho vÃ o buffer Ä‘á»ƒ cá»‘ gáº¯ng ra káº¿t quáº£ má»™t khi mongo connection thÃ nh cÃ´ng 
               ***** âœ… solution: chá»‰nh current IP address trÃªn MongoDB 

            **** QLCN 
               ***** xem thÃ´ng tin covid cá»§a nhá»¯ng nhÃ¢n viÃªn mÃ  MÃŒNH quáº£n lÃ½ 
               ***** idea: so sÃ¡nh Thoi_gian_bat_dau_theo_server vÃ  createdAt, khi Ä‘Ã³ nhÃ  quáº£n lÃ½ xÃ¡c nháº­n
               ***** Khi EJS access dá»¯ liá»‡u cá»§a MongoDB 
                  ****** SCHEMA thiáº¿u Role thÃ¬ undefined 
                     ğŸ‘‰ Role:{type: String, required: true} , Ä‘Æ°á»£c bá»• sung thÃ¬ ok âœ”ï¸
                  ****** MongoDB thiáº¿u Ma_so cÅ©ng undefined âœ”ï¸
               ***** Ä‘Ã£ trÃ­ch Ä‘Æ°á»£c táº¥t cáº£ nhÃ¢n viÃªn cá»§a 1 chi nhÃ¡nh nÃ o Ä‘Ã³ âœ”ï¸
               ***** giÃºp Quáº£n lÃ½ xem thÃ´ng tin covid tá»«ng NV âœ”ï¸
                 
               **** dÃ¹ng Flip card Ä‘á»ƒ 1 máº·t lÃ  ThÃ´ng tin nhÃ¢n viÃªn, 1 máº·t lÃ  ThÃ´ng tin Covid cá»§a ngÆ°á»i Ä‘Ã³  
            **** Candidates:
               ***** https://bbbootstrap.com/snippets/bootstrap-5-flipping-cards-for-catalog-29291738
               ***** https://bbbootstrap.com/snippets/bootstrap-5-card-flipping-using-glassmorphism-54393107
               ***** https://www.w3schools.com/howto/howto_css_flip_card.asp
                  <div class="flip-card">
                     <div class="flip-card-inner">
                        <div class="flip-card-front">
                           <img src="img_avatar.png" alt="Avatar" style="width:300px;height:300px;">
                        </div>
                        <div class="flip-card-back">
                           <h1>John Doe</h1>
                           <p>Architect & Engineer</p>
                           <p>We love that guy</p>
                        </div>
                     </div>
                  </div>
            **** láº¥y _id cá»§a nhÃ¢n viÃªn Ä‘á»ƒ yÃªu cáº§u Tá» khai Covid model find ra tá» khai cÃ³ chá»©a _id Ä‘Ã³
                     tokhaiCovidNhanvienModel.find({
                                nhanvienId: <%= nv._id  %>
                            })
                            .then(data=>{
                                console.log(`Tá» khai covid cÃ¡ nhÃ¢n cá»§a nhÃ¢n viÃªn <%= nv.Ho_ten %> `);
                            })
                            .catch(err=>console.log(err));
            ****  router.get('/edit-product/:productId', isAuth, adminController.getEditProduct); âœ”ï¸
                  <a href="/admin/edit-product/<%= product._id %>?edit=true" class="btn">Edit</a> vá»›i _id láº¥y tá»« CSDL     âœ”ï¸            
                  const employeeId = req.params.nhanvienMongoId; âœ”ï¸
                  Product.find({ userId: req.user._id })
                        .select('title price -_id')
                        .populate('userId', 'name')
                        .then(products =>  
                  //cÃ¡ch lÃ m nÃ y sáº½ táº¡o phiÃªn báº£n products má»›i cÃ³ cÃ¡c Ä‘á»‘i tÆ°á»£ng product embeds user document tÆ°Æ¡ng á»©ng âœ”ï¸
            **** hoÃ n thÃ nh Quáº£n lÃ½ xem covid cá»§a tá»«ng nhÃ¢n viÃªn cá»§a mÃ¬nh âœ”ï¸
            **** UI library  
               ***** https://bootswatch.com/   

         *** Assignment2_24 (Ä‘Ã£ xuáº¥t Ä‘Æ°á»£c pdf) âœ”ï¸
            **** giá»›i thiá»‡u vá» pdf trong express
               ğŸ‘‰  https://www.geeksforgeeks.org/how-to-send-pdf-in-express-route-response-and-force-browser-download/
            **** in PDF 
               ğŸ‘‰ https://www.youtube.com/watch?v=bSmUSLL2qKA
               ***** lÆ°u vÃ o file tÃªn Math.random() 
               ***** https://www.npmjs.com/package/pdf-creator-node
                  ğŸ‘‰   const pdf = require('pdf-creator-node')
                  ğŸ‘‰   https://youtu.be/bSmUSLL2qKA
                  ğŸ‘‰     https://youtu.be/FJYZxPflwRU
               ***** (pdfkit) 
                  ****** https://www.andronio.me/2017/09/02/pdfkit-tables/


                  ****** https://youtu.be/s4cTRyuGy_E 
                  ****** ğŸ‘‰ instead of create `hardcoded` pdf vá»›i word rá»“i convert ğŸ‘‰ for BIG files , and stream response to clients
                  ****** https://www.youtube.com/watch?v=BRJkW6Vr6yA
                  ****** https://www.npmjs.com/package/pdfkit

                  ****** https://youtu.be/s4cTRyuGy_E   (âœ…PDFKIT-CONSTRUCT package há»— trá»£ hÃ m doc.addTable)
                     ğŸ’ cÃ³ táº¡o báº£ng trong pdf

                  ****** https://www.npmjs.com/package/pdfkit-table (âœ…PDFKIT-TABLE)
                     ğŸ’ https://www.andronio.me/2017/09/02/pdfkit-tables/
                     ğŸ’ cÃ³ táº¡o báº£ng trong pdf  

                  ****** https://youtu.be/fKewAlUwRPk (âœ…PDFKIT)
                     ğŸ’ we will not store pdf doc in the server side (file system), we will not buffer everything completely in memory before sending it back to client
                     ğŸ’ Instead, we will stream the document to the client
                        ğŸ’ğŸ’ Clearly, we will basically send it back ON THE FLY (keyword nÃ y Ä‘Æ°á»£c tháº§y Maxi sá»­ dá»¥ng ) as we receive the data on the client  
                     ğŸ’ PDFKIT is a good tool, pretty simple. Read the documentation and you can do literally anything with it . But now I create pdf file to work with expressjs . Then you can figure out the documentation by yourself 
                     ğŸ’ in the main file index.js, cÃ³ app.use(express.json());
                     ğŸ’ in the routes>>index.js (the secondary index.js) 
                         router.get('/invoice',(req,res,next)=>{


                         })
                         //You can add endpoint handler to some controller level, but in this tutorial, this is just fine 
                     ğŸ’ hook the  router up inside of our express server 
                        const router=require('./router');
                        app.use(router) 
                        //ok we can use pdf 
                     ğŸ’ What I would suggest is that we make a new directory called service
                        ğŸ’ğŸ’ a pdf service  called pdf-service.js
                        ğŸ’ğŸ’ I want to have a logic of generating the pdf in a separate file 

                     ğŸ’ cháº¡y http://localhost:3002/invoice 
                        => tháº¥y browser tá»± táº£i vá» pdf chunks, láº¯p rÃ¡p hoÃ n chá»‰nh vÃ  Foxit Reader Ä‘á»c nÃ³ vÃ  má»Ÿ lÃªn
                        => ğŸ’¢ tuy nhiÃªn khÃ´ng biÃªn dá»‹ch Ä‘Æ°á»£c cÃ¡c tháº» HTML 

                     ğŸ’ THis is how you stream pdfs from express server with PDFKIT 
                         On the fly (ngay láº­p tá»©c) back to the client , without storing ot on the server's file system ! 
            **** how to readFile pdf then send to browser to open it 
                          
         
               ***** (pdfmake) https://www.npmjs.com/package/pdfmake  ğŸ‘‰ https://www.youtube.com/watch?v=WOGs7qI-iNo
                  ğŸ‘‰ PDF document generation library for server-side and client-side usage in pure JavaScript.
                  ğŸ‘‰ pdfmake is based on a truly amazing library pdfkit 
               ***** (html-pdf) https://youtu.be/NNh7rvDbfMc
                  ğŸ‘‰   Trang web cá»§a tÃ¡c giáº£ lÃ  https://freemediatools.com/
                  ğŸ‘‰ cÃ³ 1 file .html thÃ¬ cÃ³ thá»ƒ dÃ¹ng cÃº phÃ¡p trÃªn cmd Ä‘á»ƒ chuyá»ƒn thÃ nh pdf (cÃ¹ng vá»›i CSS trÃªn trang html Ä‘Ã³)
                     LÃ  thÆ° viá»‡n ráº¥t máº¡nh , báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh báº¥t cá»© HTML nÃ o vÃ  chuyá»ƒn sang pdf
                     Váº­y cÃ³ hoáº¡t Ä‘á»™ng vá»›i hÃ¬nh áº£nh lÃ m hÃ¬nh ná»n khÃ´ng -> cÃ³ , kÃ­ch thÆ°á»›c PDF Ä‘Ã£ tÄƒng lÃªn vÃ¬ Ä‘Ã£ nhÃºng hÃ¬nh áº£nh cá»§a má»™t Internet URL tá»›i hÃ¬nh trÃªn internet
                     Báº¡n cÃ³ thá»ƒ customize html theo Ã½ báº¡n thÃ­ch 
                  ğŸ‘‰ á»¨NG Dá»¤NG: táº¡o CV vá»›i htmlCSS --> pdf  
               ***** (puppeteer library) https://youtu.be/llkkwRABN-s
                  ****** https://www.youtube.com/watch?v=McYcAnauTQ8
                  ****** https://www.npmjs.com/package/puppeteer
                  ****** https://i.ytimg.com/an_webp/9VgghGKx_1c/mqdefault_6s.webp?du=3000&sqp=CM_52ZgG&rs=AOn4CLCqtZQ34tRoroxeyhjECuXpVwjuKw
                     ( Google puppeteer to convert HTML to PDF )
                  ****** ğŸ’ (Æ°u tiÃªn 1, nhÆ°ng Chromium download failed do no space left) https://youtu.be/iqv0xZgXtZw
                     ******* npm install puppeteer --save
                     ******* https://stackoverflow.com/questions/71006216/i-cant-install-puppeteer 

               ***** (jsPDF) 
                  ****** https://www.talentica.com/blogs/pdf-generation-using-nodejs/
               ***** (pdf lib) 
                  ****** https://youtu.be/0sfs0AGWU0g

         *** Thá»±c hiá»‡n pdf export:
            **** controllers >> quanlychinhanh.controller.js   âœ”ï¸
            **** const PDFDocument= require('pdfkit');  âœ”ï¸
            **** const pdfDoc=new PDFDocument();   âœ”ï¸
            **** EJS + dynamic server data / api data / database data = standard HTML âœ”ï¸
              => ğŸ’ Káº¿t quáº£ : xuáº¥t thÃ nh cÃ´ng outputEmpCovidInfo.pdf khÃ´ng bá»‹ lá»—i  âœ”ï¸
            **** real and dynamic server (example: ordering) data  => PDF 
            **** Note: bÃ i giáº£ng cá»§a Maximillian , https://youtu.be/BRJkW6Vr6yA
               ***** projectRootFolder >> data >>invoices 
               ***** tÃ¡c giáº£ muá»‘n Ä‘áº·t tÃªn file lÃ  duy nháº¥t
                    ğŸ‘‰ const invoiceName= 'invoice-' + orderId + '.pdf' ;
               ***** tÃ¡c giáº£ muá»‘n file trÃªn náº±m trong thÆ° má»¥c invoices
                    ğŸ‘‰ const invoicePath= path.join('data','invoices',invoiceName) 
                    ğŸ’ Káº¿t quáº£: KhÃ´ng cáº§n manually táº¡o tay, chá»‰ cáº§n Ä‘Æ°á»ng dáº«n trÃªn lÃ  file pdf sáº½ náº±m trong thÆ° má»¥c invoices 
               ***** tiáº¿p theo, tÃ¡c giáº£ npm install --save pdfkit cho thÆ° má»¥c controllers >> shop.js  
               ***** do pdfkit exposes to be a PDF document. Do Ä‘Ã³ Ä‘áº·t tÃªn class lÃ :
                  ğŸ‘‰  const PDFDocument= require('pdfkit');
                  ğŸ‘‰ táº¡o instance which is a ğŸ‰Readable streamğŸ‰
                       const pdfDoc=new PDFDocument();
               ***** ChÃº Ã½ lÃ  tá»« lÃºc quy Ä‘á»‹nh nÆ¡i chá»©a file cho tá»›i táº¡o thá»±c thá»ƒ pdfDoc Ä‘á»u diá»…n ra trong controllers>>shop.js trong hÃ m getInvoice 
               ***** Xá»¬ LÃ Äá»ŒC doc: yÃªu cáº§u doc pipe() its (stream) output to somewhere which is ğŸ‰Writable StreamğŸ‰ (náº¿u ta cho nÃ³ báº¥t cá»© ná»™i dung gÃ¬) for ğŸ’™ creating a file or ğŸ’™ sending a response
                  ğŸ‘‰ to a file? ğŸ’™ creating a file 
                     ğŸ’ doc.pipe(fs.createWriteStream('file_x.pdf)) 
                  ğŸ‘‰ to HTPP response object? ğŸ’™ sending a response
                     ğŸ’ doc.pipe(res) 
                  => trong bÃ i giáº£ng tÃ¡c giáº£ dÃ¹ng cáº£ 2 lá»‡nh trÃªn Ä‘á»ƒ pdf vá»«a cÃ³ trÃªn server file vá»«a gá»­i tá»›i client . TrÃªn cÆ¡ sá»Ÿ doc lÃ  Readable stream, nÃªn cÃ³ thá»ƒ hÃ²a vÃ o cÃ¡c WriteStream nhÆ° res 

               ***** Xá»¬ LÃ GHI doc: 
                  ğŸ‘‰add a single line of text into the doc ? use doc.text() 
                     ğŸ’ Ä‘Æ¡n giáº£n nháº¥t lÃ  doc.text("hello world"); 

               ***** Finalize PDF file
                  ğŸ‘‰ at some point, you wanna Káº¾T THÃšC xá»­ lÃ½ ghi , you tell node when you are done writing/piping to stream 
                  doc.end();
                     ğŸ’ Káº¿t quáº£ lÃ  : the file is saved and the HTTP response object is sent 
 
               ***** Review 
                  ğŸ‘‰ https://youtu.be/uwakm2mGjVY
                  ğŸ’ cho biáº¿t doc.end() cÃ³ thá»ƒ Ä‘á»©ng trÆ°á»›c hay sau doc.pipe() cÅ©ng Ä‘Æ°á»£c, khÃ´ng quan trá»ng 
                  ğŸ’ you can use pipe to stream directly to a response , no need to create the file first then download it 
                      doc.pipe(res);
                  ğŸ’ doc.write() is the line causing the trouble, which is also a deprecated method, so do not use it 
                  ğŸ’ Instead, use pipe to tell your doc where to stream the information, and remember to close it using doc.end() 



         **** Assignment2_25 (MÃ n hÃ¬nh 1)
               - thÃªm hÃ¬nh áº£nh cho file pdf TokhaiCovidCanhan  âœ”ï¸
                 ğŸ‘‰ tham kháº£o imageForPdf.PNG  
                 
               -â¤ï¸ Chá»n â€œCheckoutâ€ (aka "Káº¿t thÃºc lÃ m"), hiá»ƒn thá»‹ thÃ´ng tin (tá»« CSDL):
                  ğŸ†’ğŸ†• Ã tÆ°á»Ÿng: 
                  Sá»‘ giá» Ä‘Ã£ lÃ m hÃ´m nay. 
                  Danh sÃ¡ch cÃ¡c lÆ°á»£t báº¯t Ä‘áº§u, káº¿t thÃºc trong ngÃ y kÃ¨m thÃ´ng tin nÆ¡i lÃ m viá»‡c ğŸ‘‰ HÃ m find sáº½ tráº£ vá» má»™t máº£ng (https://www.geeksforgeeks.org/how-to-get-data-from-2-different-collections-of-mongodb-using-node-js/)
                  Chuyá»ƒn sang tráº¡ng thÃ¡i khÃ´ng lÃ m viá»‡c.
                  Cho phÃ©p káº¿t thÃºc lÃ m nhiá»u láº§n trong ngÃ y.
                  ğŸ‘‰ tham kháº£o assignment1 

                  â¹ Implement:
                     ğŸ‘‰route:   //GET --> /nhanvien/checkout
                                 router.get('/diemdanhra',checkLoginStatus.nhanvienIfLoggedIN,nhanvienController.getStaffCheckout);
                     ğŸ‘‰controller: 
                           exports.getStaffCheckout
                     ğŸ‘‰view
                           Phieu_checkout_nhanvien 
                     ğŸ‘‰schema: 
                           ã€½ï¸  recordedKetThucLam  

                     ğŸ˜ nháº¥n nÃºt "Check me out" sáº½ tá»›i 

                     ğŸ‘‰ route POST --> /nhanvien/checkout
                           router.post('/diemdanhra',checkLoginStatus.nhanvienIfLoggedIN,nhanvienController.postStaffCheckout);  
                     ğŸ‘‰ controller:
                           exports.postStaffCheckout=(req,res,next)=>{
                     ğŸ‘‰ view --> khÃ´ng cÃ³ 
                        X.save()
                         .then(result=>{
                           console.log("save successful");
                           res.redirect('/nhanvien/diemdanhvao');
                         })
}
                  ğŸ’¢ Problem vá»›i recordedKetThucLam:
                          //CÃ¡ch 1:
                              ///Danh_sach_cac_luot_batdau_ketthuc:[Luot_bat_dau_Luot_ket_thuc]
                          //CÃ¡ch 2:
                          Danh_sach_cac_luot_batdau_ketthuc:{type:[Luot_bat_dau_Luot_ket_thuc],required:true}, //ReferenceError: Cannot access 'Luot_bat_dau_Luot_ket_thuc' before initialization, do Ä‘Ã³ Luot_bat_dau_Luot_ket_thuc pháº£i Ä‘á»©ng trÆ°á»›c recordedKetThucLam
                          //Káº¿t luáº­n: cáº£ 2 cÃ¡ch trÃªn Ä‘á»u khÃ´ng má»Ÿ máº£ng trong MongoDb Ä‘Æ°á»£c

                  ğŸ’Š Assignment2_phan26 sáº½ thá»­ thÃªm dá»¯ liá»‡u theo Model.insert() https://stackoverflow.com/questions/46302053/mongoose-express-create-schema-with-array-of-objects
                       => /// TypeError: SchemaPhieuCheckOutNhanvien.insert is not a function 
                    
                  
                  
                  ğŸ’Š Assignment2_phan27 sáº½ thá»±c hiá»‡n giá»‘ng collection orders cá»§a tÃ¡c giáº£ Maxi
                     *** má»¥c tiÃªu lÃ  pháº£i táº¡o Ä‘Æ°á»£c máº£ng trong mongodb collection  âœ”ï¸
                     *** MongoDB ğŸ‘‰ testMongoose >> orders 
                        **** lÃ m sao lÆ°u products lÃ  Array chá»©a cÃ¡c Ä‘á»‘i tÆ°á»£ng order items 
                       
                     *** Vá» schema: âœ”ï¸
                        **** khai bÃ¡o trá»±c tiáº¿p doc chá»©a array chá»©a objects schema lÃ  gÃ¬:
                          const orderSchema = new Schema({
                             products: [
                               {
                                 product: { type: Object, required: true },
                                 quantity: { type: Number, required: true }
                               }
                             ],
                             .... })
                     *** Äiá»u chá»‰nh láº¡i Schema con sau:  
                        const Luot_bat_dau_Luot_ket_thuc=new mongoose.Schema({  âœ”ï¸
                            Luot_bat_dau:{type: String, required: true},
                            Luot_ket_thuc:{type: String, required: true},
                            Noi_lam_viec:{type:String,required: true},
                            So_phut_phien_lam_viec:{type:Number, required: true}  //bá» Thoi_gian_checkout_nhanvien_ghi:{type:String,required: true} trong recordedKetThucLam
                        });

                        //LÃ½ do: cÃ¡c láº§n checkout tiáº¿p theo:
                           /// TÃ¬m trong MongoDB 'ketthuclams' cÃ³ nhanvien Ä‘Ã³ chÆ°a, náº¿u cÃ³ thÃ¬ cáº­p nháº­t báº±ng cÃ¡ch ğŸ‘‰ sáº½ push Ä‘á»‘i tÆ°á»£ng (Luot_bat_dau,Luot_ket_thuc,Noi_lam_viec,So_phut_phien_lam_viec) vÃ o trong Máº£ng âœ”ï¸

                           /// res.redirect('/nhanvien/diemdanhvao') //idea lÃ  checkout xong sáº½ tá»›i endpoint nÃ y cÃ³ sáºµn "Tráº¡ng thÃ¡i hiá»‡n táº¡i: KhÃ´ng lÃ m viá»‡c" âœ”ï¸

                     *** ThÃªm menu option "Day Summary" Ä‘á»ƒ tá»•ng káº¿t giá» lÃ m vÃ  nÆ¡i lÃ m cá»§a má»™t nhÃ¢n viÃªn trong ngÃ y   
                        **** route
                           /nhanvien/daySummary  âœ”ï¸
                        **** controller 
                           ğŸ‘‰  exports.getDaySummary=(req,res,next)=>{
                           ğŸ‘‰  
                     *** Tiáº¿p theo
                        **** Má»¥c tiÃªu lÃ  LÆ°á»£t lÃ m viá»‡c tiáº¿p theo, NV_x cÃ³ nhu cáº§u thÃªm 1 Ä‘á»‘i tÆ°á»£ng vÃ o máº£ng Danh_sach_cac_luot_batdau_ketthuc âœ”ï¸
                        **** find vÃ  tráº£ vá» máº£ng thá»a JSON object filter,
                        **** https://www.geeksforgeeks.org/mongodb-findone-method/  tráº£ vá» Ä‘á»‘i tÆ°á»£ng Ä‘áº§u tiÃªn tháº¥y trong MongoDB
                           ***** findOne nhanvien vá»›i {id: nhanvienId}
                             => tráº£ vá» 1 Ä‘á»‘i tÆ°á»£ng Javascript 
                             ğŸ’¡ Thá»­ save() má»™t thuá»™c tÃ­nh má»›i vÃ o Ä‘t nÃ y, xem MongoDB cÃ³ cáº­p nháº­t khÃ´ng  , cÆ¡ sá»Ÿ lÃ½ thuyáº¿t lÃ  Mongoose giÃºp JS object cÃ³ liÃªn quan vá»›i collection trÃªn MongoDB 
                                 ğŸ‘‰ https://stackoverflow.com/questions/14619793/how-to-add-an-attribute-to-an-existing-document-with-mongoose
                                 ğŸ‘‰   Use the db.collection.save() to update an existing document or inserts a new document, nhÆ°ng á»Ÿ Ä‘Ã¢y Ä‘ang dÃ¹ng Mongoose 
                        **** Maximillian
                              Product.findById(productId)
                                .then(product=>
                                 // sau khi cáº­p nháº­t thuá»™c tÃ­nh nÃ o Ä‘Ã³ thÃ¬ product.save()  âœ”ï¸

                        **** plan lÃ  push object vÃ o máº£ng Danh_sach_cac_luot_batdau_ketthuc âœ”ï¸
                           ***** Khi findOne 
                              ğŸ‘‰  tÃ¬m ra doc thÃ¬ truy cáº­p máº£ng rá»“i push Ä‘á»‘i tÆ°á»£ng má»›i vÃ´ ; So_gio_da_lam_hom_nay= So_gio_da_lam_hom_nay + newHours âœ”ï¸
                           ***** Khi https://mongoosejs.com/docs/tutorials/findoneandupdate.html
                              ****** You should use save() to update documents where possible, but there are some cases where you need to use findOneAndUpdate()
                                

                     *** ğŸ Assignment2_28
                         1/ -â¤ï¸ ÄÄƒng kÃ½ nghá»‰ phÃ©p
                               
                             ğŸ‘‰ 1.1/ Chá»n ngÃ y (chá»n Ä‘Æ°á»£c cáº£ ngÃ y trong quÃ¡ khá»©, cho phÃ©p chá»n nhiá»u ngÃ y).
                             1.2/ LÃ½ do.
                             Hiá»ƒn thá»‹ thÃ´ng tin sá»‘ ngÃ y cÃ²n láº¡i (khÃ´ng thá»ƒ chá»‰nh sá»­a).
                             Náº¿u sá»‘ ngÃ y annualLeave cÃ²n láº¡i lÃ  0 thÃ¬ thÃ´ng bÃ¡o vÃ  khÃ´ng cho phÃ©p Ä‘Äƒng kÃ½.
                             Chá»n sá»‘ giá» sáº½ nghá»‰ (tá»‘i Ä‘a 8h cho má»—i ngÃ y), sá»‘ giá» sáº½ nghá»‰ pháº£i nhá» hÆ¡n sá»‘ ngÃ y annualLeave cÃ²n láº¡i (má»—i ngÃ y annualLeave = 8h). LÃºc nháº­p xong há»‡ thá»‘ng sáº½ hiá»ƒn thá»‹ quy Ä‘á»•i ra lÃ  bao nhiÃªu ngÃ y, vÃ­ dá»¥ 4h thÃ¬ hiá»‡n lÃ  0.5 ngÃ y.
                             ÄÄƒng kÃ½ xong thÃ¬ trá»« vÃ o vÃ o sá»‘ ngÃ y annualLeave cÃ²n láº¡i. Sá»‘ ngÃ y annualLeave nÃ y khÃ´ng bao giá» máº¥t Ä‘i náº¿u khÃ´ng dÃ¹ng Ä‘áº¿n, má»—i nÄƒm admin sáº½ tiáº¿n hÃ nh add thÃªm annualLeave báº±ng má»™t há»‡ thá»‘ng khÃ¡c.
                            

                             ğŸ‘‰ Ä‘iá»u kiá»‡n lÃ  annualLeave > 0 . Náº¿u = 0 thÃ¬ khÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ nghá»‰ phÃ©p
                             **** router

                                 ***** //GET --> /nhanvien/dangkynghiphep
                                      router.get('/dangkynghiphep',checkLoginStatus.nhanvienIfLoggedIN,nhanvienController.getPhieuNghiPhep); âœ”ï¸
                                 
                                 ***** //POST --> /nhanvien/dangkynghiphep
                                      router.post('/dangkynghiphep',checkLoginStatus.nhanvienIfLoggedIN,nhanvienController.postPhieuNghiPhep);
                                      ğŸ‘‰ (khi gá»­i array cÃ¡c date and hour Ä‘á»ƒ Ä‘Äƒng kÃ½ nghá»‰ phÃ©p) https://stackoverflow.com/questions/42610022/receive-form-data-in-an-array-in-node-js-using-express
                             **** controllers
                             **** view "phieunghiphep"âœ”ï¸
                                ***** HTML multiple select with checkbox https://estradawebgroup.com/Post/How-to-implement-multiple-selection-with-check-boxes-in-an-HTML-select-control-using-jQuery/4231
                                ***** https://demo.mobiscroll.com/angular/calendar/multiple-select#

                             **** schema "phieunghiphep"
                                 ***** thÃªm thuá»™c tÃ­nh sau cho nhanvien
                                    annualLeave:{   âœ”ï¸
                                        type:Number,
                                        min:0,
                                        max:12
                                    },
                                    => thÃªm annualLeave cho cÃ¡c nhÃ¢n viÃªn trong CSDL  âœ”ï¸

                              **** https://youtu.be/LHzqNLaVhYw  (jquery date picker)
                              **** https://adnan-tech.com/calculate-difference-between-2-dates-jquery/
                              **** https://stackoverflow.com/questions/29119009/choose-multiple-dates-in-date-input-in-html
                              **** â¤ï¸ http://dubrox.github.io/Multiple-Dates-Picker-for-jQuery-UI/
                                => ğŸ’Š https://github.com/dubrox/Multiple-Dates-Picker-for-jQuery-UI/

                              **** â¤ï¸ https://www.npmjs.com/package/mui-multiple-dates-picker
                              **** https://youtu.be/rMwJQLsnyQo (How to implement multiple date selection in jQuery)

                        *** ğŸ Assignment2_29

                        1/ trong 2_28 thÃ¬ name"  []" khÃ´ng Ä‘Æ°á»£c nháº­n lÃ  array (false)
                           => trong 2_29 sáº½ sá»­a Ä‘iá»u nÃ y trong 2 files dangkynghiphep.js vÃ  dangkynghiphep.ejs   
                                 const phieunghiphepSchema=new mongoose.Schema({   âœ”ï¸
                           **** cho phÃ©p chá»n nhiá»u ngÃ y âœ”ï¸
                           **** Hiá»ƒn thá»‹ thÃ´ng tin sá»‘ ngÃ y cÃ²n láº¡i (khÃ´ng thá»ƒ chá»‰nh sá»­a).âœ”ï¸
                           **** Náº¿u sá»‘ ngÃ y annualLeave cÃ²n láº¡i lÃ  0 thÃ¬ thÃ´ng bÃ¡o vÃ  khÃ´ng cho phÃ©p Ä‘Äƒng kÃ½ (nhÆ° NV_2)
                              => cáº£ case annualLeave=0 hay >0 thÃ¬ diable a button with HTML and CSS : https://lifeincoding.com/how-to-disable-button-with-css/ âœ”ï¸ (má»™t cÃ¡ch phÃ¡ há»§y sá»± async: When the details are not yet entered by the user then clicking the button is of no use so it can be kept disabled.)
                           **** Báº«y: Model.save is not a function  => pháº£i táº¡o instance cá»§a Model má»›i gá»i save() Ä‘Æ°á»£c âœ”ï¸
                           **** Ä‘Ã£ lÆ°u phieunghiphep vÃ o csdLâœ”ï¸
                           **** ğŸ’¢ Chá»n sá»‘ giá» sáº½ nghá»‰ (tá»‘i Ä‘a max= 8h cho má»—i ngÃ y), sá»‘ giá» sáº½ nghá»‰ pháº£i nhá» hÆ¡n sá»‘ ngÃ y annualLeave cÃ²n láº¡i (má»—i ngÃ y annualLeave = 8h). LÃºc nháº­p xong há»‡ thá»‘ng sáº½ hiá»ƒn thá»‹ quy Ä‘á»•i ra lÃ  bao nhiÃªu ngÃ y, vÃ­ dá»¥ 4h thÃ¬ hiá»‡n lÃ  0.5 ngÃ y.
                               => náº¿u annualLeave cÃ²n láº¡i lÃ  0.2 ngÃ y (hay 4.8h) thÃ¬ tá»•ng h nghá»‰ cho n ngÃ y pháº£i < 4.8h âœ”ï¸
                           **** ğŸ’¢ má»—i khi nháº­p má»™t sá»‘ thÃ¬ sum tá»± tÄƒng lÃªn, xÃ³a má»™t sá»‘ thÃ¬ sum tá»± giáº£m âœ”ï¸
                               => ğŸ‘‰ https://stackoverflow.com/questions/13540751/how-get-total-sum-from-input-box-values-using-javascript
                                https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/isNaN
                                https://www.urbandictionary.com/define.php?term=nbsp ğŸ‘‰ "&nbsp;" is the HTML encoding for a non-breaking space, which is a space that doesn't get removed by the browser on rendering.
                           **** jquery tiáº¿p cáº­n content of HTML: <span id="sum" style="font-weight: bold;background-color:yellow">0</span> thÃ¬ $("#sum").html(sum.toFixed(2)); âœ”ï¸
                           **** jquery get and set input's value vá»›i hÃ m val(): https://www.geeksforgeeks.org/how-to-get-the-value-in-an-input-text-box-using-jquery/ âœ”ï¸
                           **** https://stackoverflow.com/questions/52404681/how-to-check-value-of-input-is-greater-than-12-in-jquery-using-if-statement âœ”ï¸

                           **** Demo ná»™p Ä‘Æ¡n xin nghá»‰ phÃ©p lÃªn CSDL âœ”ï¸

                        2/ â¤ï¸ upload Ä‘á»ƒ cáº­p nháº­t hÃ¬nh áº£nh avartar cá»§a nhan vien 
                         ***** Chuáº©n bá»‹
                           âœï¸ táº¡o "uploadAvatarNhanvien" lÃ  nÆ¡i chá»©a hÃ¬nh upload cá»§a nhÃ¢n viÃªn trong file (vá»›i engine diskStorage())
                              => náº±m trong public/images Ä‘á»ƒ cÃ³ thá»ƒ serve statically bá»Ÿi Express server (server sá»­ dá»¥ng thÆ° viá»‡n Express) ?? KhÃ´ng cáº§n hÆ¡n ná»¯a security lá»™ trÃªn máº¡ng , Ä‘á»ƒ chá»— nÃ o multer cÅ©ng tÃ¬m Ä‘Æ°á»£c path, náº¿u Ä‘á»ƒ trong static folder thÃ¬ lá»™ Ä‘Æ°á»ng dáº«n 
                                 BÃ i cá»§a Maxi khÃ´ng dÃ¹ng public Ä‘á»ƒ truy cáº­p hÃ¬nh trong URL 
                           âœï¸ lÆ°u path náº±m trong req.file which is created by multer vÃ o trong MongoDB 
                              => muá»‘n hiá»ƒn thá»‹ (display) hÃ¬nh thÃ¬ chá»‰ cáº§n ejs Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i nÃ y vÃ o thuá»™c tÃ­nh src=" "
                              => do hÃ¬nh lÃºc nÃ o cÅ©ng táº¡o má»›i rá»“i lÆ°u trong file --> khÃ´ng cáº§n ghi Ä‘Ã¨ hÃ¬nh cÅ© , dÃ¹ upload hÃ¬nh cÅ© nhÆ°ng tÃªn file khÃ¡c nhau luÃ´n luÃ´n 
                           âœï¸ xem Lab10.28: exports.postEditProduct = (req, res, next) => {    
                              => cáº­p nháº­t imageUrl trÃªn MongoDB báº±ng instance.save() , lÃºc Ä‘Ã³ src sáº½ nháº­n dá»¯ liá»‡u Ä‘á»™ng tá»« ngÆ°á»i dÃ¹ng Ä‘á»ƒ tá»›i chá»— cÃ³ hÃ¬nh áº£nh, rá»“i Express render EJS chá»— Ä‘Ã³ Ä‘á»ƒ hiá»ƒn thá»‹ 
                              ğŸ§¡ //ThÃªm field sau cho nhanvien.schema.js âœ”ï¸
                                 imageMulterPath: {
                                     type: String,
                                     required: true
                                 }
                              ğŸ§¡ nhanvienProfile.ejs âœ”ï¸
                                 <form enctype="multipart/form-data" method="POST" action="/nhanvien/view_personal_profile">
                                    <input id="empAvatar" type="file" class="form-control" name="empAvatar"/>
                                    <input type="submit" class="btn btn-success" value="Upload Avartar">
                                 </form>

                              ğŸ§¡ npm install --save multer âœ”ï¸
                              ğŸ§¡ Trong index.js: 
                                 **   const multer= require("multer") âœ”ï¸
                                 **   app.use(multer().single('empAvatar')); âœ”ï¸
                                 **   yÃªu cáº§u multer chuáº©n bá»‹ (setup) storage engine
                                    *** app.use(multer({storage}).single('empAvatar'));
                                 **  set up diskStorage báº±ng cÃ¡ch gÃ¡n hÃ m fileStorage vÃ o keyword storageâœ”ï¸
                                    *** app.use(multer({storage:fileStorage}).single('empAvatar')); âœ”ï¸

                                 ** add a filter to multer to only allow certain kinds of files, báº±ng cÃ¡ch gÃ¡n hÃ m fileFilter vÃ o keyword fileFilter
                                    *** trong hÃ m multer(), thÃªm property fileFilter

                              ğŸ§¡ Demo tháº¥y multer hoáº¡t Ä‘á»™ng tá»‘t  
                                 -> táº¡o cÃ¡c image files vÃ o thÆ° má»¥c uploadAvatarNhanvien âœ”ï¸

                                 ** tiáº¿p, táº¡o controller Ä‘á»ƒ nháº­n var binaryData= req.file.empAvatar;
                                    *** POST req tá»›i /nhanvien/view_personal_profile
                                    *** console.log(req.file) //xem cÃ¡c originalname, fieldname

                              ğŸ§¡ğŸ’¢ PROBLEM: nhÆ°ng path cá»§a multer cÃ³ public Ä‘á»©ng trÆ°á»›c. Do Ä‘Ã³ giáº£i phÃ¡p lÃ  â¤ï¸ cho nhanvienProfile.ejs nÃ y vÃ o 1 thÆ° má»¥c cáº¥p dÆ°á»›i 1 báº­c cá»§a view, lÃºc Ä‘Ã³ cÃ³ thá»ƒ paste multer's path vÃ o src-->
                                 => Assignment2_phan30
                                    *** cho nhanvienProfile.ejs vÃ o thÆ° má»¥c nhanvien , thuá»™c views  âœ”ï¸
                                    *** vÃ o nhanvienProfile.ejs Ä‘á»ƒ xem img cÃ³ src chá»©a public cháº¡y Ä‘Æ°á»£c khÃ´ng
                                    *** ğŸ”‘chÃ¬a khÃ³a lÃ : app.use('/public',express.static(path.join(__dirname, 'public'))); //tuy nhiÃªn dÃ²ng nÃ y works
                           
                           
                       

                           âœï¸ xem appLTV: 
                              ğŸ’™<form action="/Nhan_vien/Chon_chuc_nang" method="get" style="width:200px" class="btn">
                                    <input type="hidden" value="Cap_nhat_Hinh" name="Th_Ma_so_chuc_nang" />
                                    <input name="Th_Ma_so_Nhan_vien" value="${Nhan_vien_dang_login.Ma_so}"  type="hidden" />
                                    <button type="submit" class="btn btn-dark">
                                        Cáº­p nháº­t<br/>HÃ¬nh
                                    </button>
                                 </form>

                              ğŸ’™ if(Ma_so_Chuc_nang=="Cap_nhat_Hinh"){
                                    Chuoi_HTML+=XL_3L.Tao_Chuoi_HTML_Chuc_nang_Cap_nhat_Hinh(Nhan_vien_dang_login)

                              ğŸ’™ Tao_Chuoi_HTML_Chuc_nang_Cap_nhat_Hinh(Nhan_vien_dang_login){
                                     var Chuoi_HTML=""  //Ä‘á»‹nh nghÄ©a chuá»—i khÃ´ng dÃ¹ng Template Literal
                                     //trong accept khÃ´ng cÃ³ jpg thÃ¬ browse sáº½ khÃ´ng cÃ³ rock.jpg

                                     //Ä‘á»‹nh nghÄ©a chuá»—i dÃ¹ng Template Literal:
                                     Chuoi_HTML=`
                                          <form action="/Thuc_hien_chuc_nang" method="POST" enctype="multipart/form-data">
                                                    <div class="alert" style="height: 20px;">Cáº­p nháº­t HÃ¬nh cá»§a ${Nhan_vien_dang_login.Ho_ten}</div>
                                                    <div class="alert" style="height: 20px;">
                                                        <input type="hidden"  name="Th_Thuc_hien_Chuc_nang" value="Cap_nhat_Hinh" >
                                                        <input type="file"  name="Th_cap_nhat_Hinh" accept="image/png/jpg" > 
                                                    </div>    
                                                    <div class="alert" style="height: 20px;">
                                                         <button class="btn btn-success">Äá»“ng Ã½</button>
                                                    </div>
                                           </form>
                                     `
                                     return Chuoi_HTML
                                 }

                              ğŸ’™  app.post('/Thuc_hien_chuc_nang',(req,res)=>{
                                     if(Thuc_hien_Chuc_nang=='Cap_nhat_Hinh'){
                                         //============Biáº¿n nguá»“n
                                         var Tap_tin_Hinh= req.files.Th_cap_nhat_Hinh  //When you upload a file, the file will be accessible from req.files
                                         var Du_lieu_tap_tin_hinh=req.files.Th_cap_nhat_Hinh.data
                                         //============Káº¿t xuáº¥t
                                         XL_3L.Ghi_Hinh_Nhan_vien(Nhan_vien_dang_login, Du_lieu_tap_tin_hinh) 

                              ğŸ’™    Ghi_Hinh_Nhan_vien(Nhan_vien_dang_login, Tap_tin_Hinh){
                                       var Path=`../Media/${Nhan_vien_dang_login.Ma_so}.png`
                                       //ghi Ä‘Ã¨ vÃ´ file hÃ¬nh hiá»‡n táº¡i (VD NV_1.png). Chá»© khÃ´ng tá»± Ä‘á»™ng táº¡o tÃªn file má»›i
                                       FS.writeFileSync(Path,Tap_tin_Hinh)  //Tap_tin_Hinh lÃ  pháº§n data truyá»n tá»›i. Táº¡i NV_1.png, dá»¯ liá»‡u file nÃ y ban Ä‘áº§u lÃ  hÃ¬nh cá»§a BÃ nh KhuÃª sáº½ Ä‘Æ°á»£c tháº¿ lÃ  hÃ¬nh cá»§a Batista (NV_1.png) , khÃ´ng tháº¿ báº±ng rock.jpg Ä‘Æ°á»£c  
                                    }

                              ğŸ§¡ğŸ§¡ NhÆ°á»£c Ä‘iá»ƒm: ghi Ä‘Ã¨ hÃ¬nh má»›i lÃªn hÃ¬nh cÅ© , lÃ m máº¥t hÃ¬nh 
                              ğŸ§¡ğŸ§¡ Kháº¯c phá»¥c: lÆ°u reference trÃªn MongoDB tá»›i tá»«ng unique hÃ¬nh, hÃ¬nh má»›i sáº½ táº¡o má»›i trÃªn server mÃ  váº«n giá»¯ hÃ¬nh cÅ©
                            
                            
                        ***ğŸ Assignment2_phan30

                                 ğŸ’ Solution:
                                    <img style="width:28rem;padding-top:2rem" src="\public\userUploadAvatar\r.png" alt="r with virtual prefix \public"> <!--anh nÃ y cÃ³ thá»ƒ dynamic vá»›i multer path-->
                                    <img style="width:28rem;padding-top:2rem" src="/public/userUploadAvatar/r.png" alt="r with virtual prefix /public"><!--anh nÃ y cÃ³ thá»ƒ dynamic vá»›i multer path-->
                                    <img style="width:28rem;padding-top:2rem" src="\..\..\public\userUploadAvatar\r.png" alt="r absolute/relative path" > <!--anh nÃ y chá»©ng minh trong index.js khÃ´ng cáº§n app.use('/public',express.static(path.join(__dirname, 'public'))); ğŸ‘‰ xem Assignment2_phan31-->
                                    <img style="width:28rem;padding-top:2rem" src="/userUploadAvatar/r.png" alt="r from static folder public" > <!--â¤ï¸ anh nÃ y tuy ok, nhÆ°ng dynamic Ä‘Æ°á»£c vá»›i multer path vÃ¬ multer path cÃ³ chá»¯ public Ä‘á»©ng prefix-->   


                        ***ğŸ Assignment2_phan31
                           **** bá» Ä‘i app.use('/public',express.static(path.join(__dirname, 'public'))); //KhÃ´ng bá» Ä‘Æ°á»£c vÃ¬ nÃ³ phá»‘i há»£p vá»›i img sau Ä‘Ã¢y: âœ”ï¸
                           **** dÃ¹ng <img style="width:28rem;padding-top:2rem" src="\..\..\public\userUploadAvatar\r.png" alt="r absolute/relative path" > <!--anh nÃ y chá»©ng minh trong index.js khÃ´ng cáº§n app.use('/public',express.static(path.join(__dirname, 'public'))); ğŸ‘‰ xem Assignment2_phan31-->  âœ”ï¸
                           **** Demo Ä‘Ã£ upload Ä‘Æ°á»£c áº£nh cho 7 nhÃ¢n viÃªn 
                              ***** instance.save() tá»± Ä‘á»™ng thÃªm thuá»™c tÃ­nh vÃ o MongoDB mÃ  khÃ´ng cáº§n manually viáº¿t vÃ o trong MongoDB  âœ”ï¸
                              ***** báº£n thÃ¢n Math.random() khÃ´ng táº¡o Ä‘Æ°á»£c security, nÃªn pháº£i Ä‘iá»u chá»‰nh theo npm multer   âœ”ï¸
                           **** Demo thá»­ thay Ä‘á»•i NV_1.png thÃ nh nhanvienAlien.PNG âœ”ï¸
                               => perfect âœ”ï¸
                           **** ğŸ’¢ bá»‹ run out of space vÃ¬ cÃ¡c file áº£nh quÃ¡ nhiá»u trong cÃ¡c folder --> Ä‘em ra riÃªng 1 folder khÃ¡c 
                               => váº«n update hÃ¬nh perfectly âœ”ï¸
                           **** Day summary nhÆ°ng khÃ´ng tÃ¬m ra phiáº¿u nÃ o. CÃ³ 2 lÃ½ do  âœ”ï¸
                              ***** vá»›i tÃªn nhÃ¢n viÃªn há»£p lá»‡, anh nÃ y chÆ°a checkout nÃªn chÆ°a cÃ³ phiáº¿u 
                              ***** ğŸ‘‰ tÃªn nhÃ¢n viÃªn khÃ´ng há»£p lá»‡ (VD trong nhanviens thÃ¬ "BÃ nh Ä‘Ã¬nh thá»¥y khuÃª" nhÆ°ng trong ketthuclams lÃ  cÃ³ whitespace "BÃ nh Ä‘Ã¬nh thá»¥y khuÃª ", lá»—i nÃ y hay gáº·p khi manually nháº­p), táº¡o ra inconsistent Ho_ten giá»¯a 2 báº£ng âœ”ï¸

                        ***ğŸ Assignment2_phan32      
                           **** Ä‘Ã£ sá»­a problem vá» reduce() máº£ng khi tÃ­nh Tong ket day cho nhan vien  âœ”ï¸
                           **** khi lÃªn Heroku thÃ¬ khÃ´ng Log in Ä‘Æ°á»£c
                           **** Possible solutions
                              ***** https://stackoverflow.com/questions/70295250/node-js-app-is-not-working-after-deploying-to-heroku
                              ***** app.listen(process.env.PORT || 8080, '0.0.0.0' ,{}=>{
                                       console.log("Server is running");
                                    }) // "0.0.0.0" lÃ  Ä‘á»‹a chá»‰ IP cá»§a MongoDB cho phÃ¡p access from averywhere 
                              ***** https://stackoverflow.com/questions/56777088/unable-to-connect-to-mongodb-database-with-my-heroku-app
                              
                              




                         ***** Quyá»n háº¡n: nhÃ¢n viÃªn chá»‰ cÃ³ thá»ƒ sá»­a Image (cÃ³ thá»ƒ chá»‰nh sá»­a báº±ng cÃ¡ch upload file)
                         ***** YÃªu cáº§u: CÃ¡c chá»©c nÄƒng á»Ÿ mÃ n hÃ¬nh MH-2 hoáº¡t Ä‘á»™ng Ä‘Ãºng yÃªu cáº§u: YÃªu cáº§u Ä‘Äƒng nháº­p náº¿u chÆ°a Ä‘Äƒng nháº­p. CÃ³ thá»ƒ thay Ä‘á»•i hÃ¬nh áº£nh báº±ng cÃ¡ch upload file.
                         ***** upload hÃ¬nh vÃ o server 
                            **** https://youtu.be/fACSczNshtI  (tiáº¿ng viá»‡t)
                            **** https://youtu.be/NNh7rvDbfMc  
                            **** https://i.ytimg.com/an_webp/myLWWN2dCIw/mqdefault_6s.webp?du=3000&sqp=CMTs25gG&rs=AOn4CLD1CXVojvqtdLlvzsFDVprOVEopZw                   

                         ***** Tham kháº£o appLTV: 
                           ****** <form action="/Nhan_vien/Chon_chuc_nang" method="get" style="width:200px" class="btn">
                                      <input type="hidden" value="Cap_nhat_Hinh" name="Th_Ma_so_chuc_nang" />
                                      <input name="Th_Ma_so_Nhan_vien" value="${Nhan_vien_dang_login.Ma_so}"  type="hidden" />
                                      <button type="submit" class="btn btn-dark">
                                          Cáº­p nháº­t<br/>HÃ¬nh
                                      </button>
                                  </form>

                           ****** <form action="/uploadphoto" enctype="multipart/form-data" method="POST">
                                      <input type="file" name="myImage" accept="image/*">
                                      <input type="submit" value="Upload Photo">
                                  </form>
                                  ğŸ‘‰https://codedec.com/tutorials/image-uploading-to-mongodb-in-nodejs/

                           ****** <form action="/action_page.php">
                                      <label for="img">Select image:</label>
                                      <input type="file" id="img" name="img" accept="image/*">
                                      <input type="submit">
                                  </form>
                                  
                                  ğŸ‘‰  https://www.w3schools.com/TAGS/att_input_accept.asp => The accept attribute specifies a filter for what file types the user can pick from the file input dialog box.
                                  ğŸ‘‰  Note: The accept attribute can only be used with <input type="file">.
                                  ğŸ‘‰  Tip: Do not use this attribute as a validation tool. File uploads should be validated on the server.  
                                  ğŸ‘‰  client validation: <input accept="file_extension|audio/*|video/*|image/*|media_type">

                           ****** "express-fileupload" vs "multer"
                              ******* https://www.npmjs.com/package/express-fileupload
                                 ğŸ‘‰ const file_uploader=require('express-fileupload') 
                                 ğŸ‘‰    app.use(file_uploader())
                                 ğŸ‘‰ Simple express middleware for uploading files.
                                    
                                    <form ref='uploadForm' 
                              			id='uploadForm' 
                              			action='/upload' 
                              			method='post' 
                              			encType="ğŸ’ multipart/form-data">   <!--enctype cÅ©ng ok-->
                              			ğŸ’	<input type="file" name="sampleFile" />
                              				<input type='submit' value='Upload!' />
                              		</form>		

                                 ğŸ‘‰ When you upload a file, the file will be accessible from req.files
                                     app.post('/upload', function(req, res) {
                                          console.log(ğŸ’req.files.foo); // the uploaded file object
                                     });

                                 ğŸ‘‰   VD trong appLTV: CHá»ˆ CÃ“ UPLOAD FILE, chá»© khÃ´ng upload text Ä‘á»“ng thá»i vá»›i file

                                    Tao_Chuoi_HTML_Chuc_nang_Cap_nhat_Hinh(Nhan_vien_dang_login){
                                          var Chuoi_HTML=""
                                          //trong accept khÃ´ng cÃ³ jpg thÃ¬ browse sáº½ khÃ´ng cÃ³ rock.jpg
                                          Chuoi_HTML=`
                                              ğŸ’ <form action="/Thuc_hien_chuc_nang" method="POST" enctype="multipart/form-data">
                                                         <div class="alert" style="height: 20px;">Cáº­p nháº­t HÃ¬nh cá»§a ${Nhan_vien_dang_login.Ho_ten}</div>
                                                         <div class="alert" style="height: 20px;">
                                                             <input type="hidden"  name="Th_Thuc_hien_Chuc_nang" value="Cap_nhat_Hinh" >
                                                            ğŸ’ <input type="file"  name="Th_cap_nhat_Hinh" accept="image/png/jpg" > 
                                                         </div>    
                                                         <div class="alert" style="height: 20px;">
                                                              <button class="btn btn-success">Äá»“ng Ã½</button>
                                                         </div>
                                                </form>
                                          `
                                          return Chuoi_HTML
                                    }


                                    ğŸ’ app.post('/Thuc_hien_chuc_nang',(req,res)=>{
                                          if(Thuc_hien_Chuc_nang=='Cap_nhat_Hinh'){
                                             var Du_lieu_tap_tin_hinh=req.files.Th_cap_nhat_Hinh.data

                                    ğŸ’ XL_3L.Ghi_Hinh_Nhan_vien(Nhan_vien_dang_login, Du_lieu_tap_tin_hinh)
                                    ğŸ’ Ghi_Hinh_Nhan_vien(Nhan_vien_dang_login, Tap_tin_Hinh){
                                           var Path=`../Media/${Nhan_vien_dang_login.Ma_so}.png`
                                           ğŸ’ FS.writeFileSync(Path,Tap_tin_Hinh)  //Tap_tin_Hinh lÃ  pháº§n data truyá»n tá»›i. Táº¡i NV_1.png, dá»¯ liá»‡u file nÃ y ban Ä‘áº§u lÃ  hÃ¬nh cá»§a BÃ nh KhuÃª sáº½ Ä‘Æ°á»£c tháº¿ lÃ  hÃ¬nh cá»§a Batista (NV_1.png) , khÃ´ng tháº¿ báº±ng rock.jpg Ä‘Æ°á»£c  
                                       }


                              ******* Use temp files instead of memory for managing the upload process
                                   // Note that this option available for versions 1.0.0 and newer. 
                                 ğŸ‘‰   app.use(fileUpload({
                                           useTempFiles : true,
                                           tempFileDir : '/tmp/'
                                       }));

                              ******* Váº¬Y express-fileupload cÃ³ xá»­ lÃ½ mixed data (file+text) nhÆ° multer khÃ´ng ?? 
                                 ğŸ‘‰ https://stackoverflow.com/questions/64803772/nodejs-fileupload-multer-vs-express-fileupload-which-to-use
                                    + Base64 or Multipart? 
                                    + Multipart is a way to upload data to server in the form of part which are in bytes. Multpart/form-data is applied to a form though, so you can send everything in a multi-part form, including "regular" data also.
                              *******ğŸ‘‰ https://sebhastian.com/express-fileupload/ 

                           ***** $.ajax file upload

                              ******* https://codeforgeek.com/ajax-file-upload-node-js/ ğŸ‘‰ need jquery.form

                           ***** express-fileupload 
                              ******* mÃ´n NMCNPM appLTV 
                              ******* https://youtu.be/hyJiNTFtQic

                           ***** multer  (https://www.npmjs.com/package/multer)
                              ******* (article) https://afteracademy.com/blog/file-upload-with-multer-in-nodejs-and-express
                              ******* (Tiáº¿ng Viá»‡t) https://youtu.be/rEV3OYFsUWw
                                 ğŸ‘‰    lÆ°u tÃªn file áº£nh vá»›i Date.now() hay Math.round(Math.random()*1E9)
                                 ğŸ‘‰    diskStorage
                              ******* â¤ï¸ Special case: https://youtu.be/zyHkexA4ZBw  ğŸ‘‰ update user profile image with multer express mongoose 
                              ******* (nÃ¢ng cao: lÆ°u hÃ¬nh trong database dÆ°á»›i dáº¡ng binary )https://stackoverflow.com/questions/67083436/mongodb-multer-how-do-i-convert-a-buffer-binary-to-an-image
                              ******* (binary buffer to stream) https://github.com/expressjs/multer/issues/797
                              ******* https://gist.github.com/bbottema/390852735943edecc9f1
                              ******* âœ… https://codedec.com/tutorials/image-uploading-to-mongodb-in-nodejs/
                              ******* https://www.tabnine.com/code/javascript/functions/multer/File/buffer

                           ***** Binary data, Stream, Buffer
                              ğŸ‘‰ https://dev.to/areknawo/node-js-file-streams-explained-535e
                              ğŸ‘‰ https://dev.to/aws-builders/things-to-know-before-streaming-data-4h5m
                              ğŸ‘‰ https://dev.to/ali_a_koye/simplest-uploader-creating-powerful-nodejs-object-uploader-359o
                              ğŸ‘‰ https://dev.to/lokosama/node-js-upload-binary-image-on-the-fly-with-fastify-and-cloudinary-5c1h    
                              ğŸ‘‰ https://www.lifewire.com/how-to-avoid-buffering-issues-1847399
                              ğŸ‘‰ https://www.geeksforgeeks.org/streaming-stored-video/
                              ğŸ‘‰ https://stackoverflow.com/questions/45805890/node-multer-memory-storage-how-to-release-memory
                              ğŸ‘‰ https://www.digitalocean.com/community/tutorials/using-buffers-in-node-js

                              ******* https://expressjs.com/en/resources/middleware/multer.html
                              ******* is primarily used for uploading files
                              ******* NOTE: Multer will not process any form which is not multipart (multipart/form-data) 
                                    <form action="/profile" method="post" enctype="multipart/form-data">
                                          <input type="file" name="avatar" />   //giá»‘ng lÃºc lÃ m express-fileupload
                                    </form>
 

                     





           
          
         
          
         
         
         
         
         
         *** CSRF attack
            **** cho cÃ¡c form POST , cÃ²n nÃ³i chung thÃ¬ view ??
            **** https://security.stackexchange.com/questions/90023/get-and-post-request-vulnerable-to-csrf-attack
            **** https://www.geeksforgeeks.org/what-is-cross-site-request-forgery-csrf/
            **** https://www.fullstackgeeks.com/cross-site-request-forgery/
            **** https://owasp.org/www-community/attacks/csrf


      ** exports.postSignup=(req,res,next)=>{
    console.log("admin postSignup here, begin to process user input on server");
    //nháº­n dá»¯ liá»‡u user input vÃ  errors collection tá»« express-validator
    //náº¿u cÃ³ lá»—i thÃ¬ bÃ¡o msg "Passwords have to match!" ngay táº¡i trang form sign up luÃ´n, khÃ´ng bÃ¡o sau khi redirect lá»›i admin/login
        ///"Passwords have to match!" lÃ  tá»« express-validator, váº­y lÃ m sao view xá»­ lÃ½ hiá»ƒn thá»‹ ra HTML?
        ///errorMessage: errors.array()[0].msg, //Ä‘Ã¢y lÃ  Ä‘iá»u kiá»‡n Ä‘á»ƒ há»™p bÃ¡o lá»—i hiá»‡n lÃªn
    const expressValidationErrors=validationResult(req);

    if (!expressValidationErrors.isEmpty()) {
        console.log(expressValidationErrors.array());
    
        //ğŸ½ re-render the previous view (xá»­ lÃ½ hiá»ƒn thá»‹ view láº§n trÆ°á»›c , cÅ©ng lÃ  yÃªu cáº§u ASM2 ) âœ”ï¸
        return res.status(422).render('auth/signup', {

      ** MemoryStore: DÃ¹ khÃ´ng designed cho production,
         *** admin's getSignup, Ä‘Ã£ truy cáº­p thÃ nh cÃ´ng sesssion data tá»« MemoryStore  âœ”ï¸
            **** Register LyVietKhang from VietNam
         *** sau khi login thÃ nh cÃ´ng, tiáº¿p tá»¥c dÃ¹ng MemoryStore lÆ°u user vÃ o session Ä‘á»ƒ lÃ m middleware
               // middleware to test if authenticated
               function isAuthenticated (req, res, next) {
                     if (req.session.user) next()
                     else next('route')
               }

      ** MongoStore
         *** KhÃ´ng dÃ¹ng MemoryStore Ä‘á»ƒ lÆ°u session trÃªn RAM memory (sáº½ máº¥t thÃ´ng tin náº¿u server down máº¥t Ä‘iá»‡n vÃ¬ temporary thÃ´i)
            **** trang getSignup cá»§a admin, thá»­ truy cáº­p tÃªn admin vÃ  country trong MemoryStore
               ***** how? https://www.npmjs.com/package/memorystore
               ***** http://expressjs-book.com/index.html%3Fp=128.html
                  ******* Express comes with a built-in SESSION store called MemoryStore, which is the default when you donâ€™t specify one explicitly.
                  ******* MemoryStore uses the application RAM for storing session data and works right out of the box, without the need for any DATABASE
               ***** express-session full-featured MemoryStore module without leaks!
         *** admin.schema.js âœ”ï¸
            **** adminSchema=new mongoose.Schema() 
            **** module.exports=adminSchema 
         *** admin.models.js âœ”ï¸
            **** module.exports=mongoose.model("tÃªn model", adminSchema);
         *** router.get('/register', adminController.getSignup);  âœ”ï¸
         *** exports.postSignup=(req,res,next)=>{
    
         }

         **** táº¡i admin's postSignup: thu tháº­p 3 thÃ´ng tin sau
            ***** trÆ°á»›c khi tá»›i postSignup controller, thá»±c hiá»‡n validate confirmingPassword
               ***** input tá»« Ã´ tÃªn "password2"
            ***** {email,password}=req.body;   //vá»›i admin thÃ¬ Ten_Dang_nhap lÃ  lyvietkhang vÃ  Mat_khau lÃ  123456 Ä‘Ã£ lÆ°u trong file .env
               ***** cÃ¡c input tá»« Ã´ tÃªn "username" vÃ  "password"
            ***** const errors = validationResult(req);
            ***** router.post('/register',validate,adminController.postSignup);
 
         **** sau Ä‘Ã³
               const user = new Admin({
                     /// theo tiÃªu chuáº©n cá»§a schema
                 });
               return user.save(); //lÆ°u vÃ o MongoDB 

         **** signup thÃ nh cÃ´ng thÃ¬ res.redirect('/login'); 

      âš½ï¸ sau khi Ä‘Äƒng kÃ½ username vÃ  password admin, sau Ä‘Ã³ login 
         //**** authentication.controller.js 
         //**** authentication.route.js 
         **** authentication.view.js (login, signup, reset, new-password) => khÃ´ng cáº§n, vÃ¬ nÃ³ sáº½ Ä‘á»“ng cáº¥p vá»›i thÆ° má»¥c Layouts
         â‰ï¸âš ï¸ Tuy nhiÃªn , cÃ¡c authentication trÃªn nháº±m vÃ o Loáº¡i Ä‘á»‘i tÆ°á»£ng Con ngÆ°á»i nÃ o? (Admin? quanlychinhanh? nhanvien? khachthamquan?)
            =>ğŸ’œ cÃ¢u tráº£ lá»i lÃ  cho ai (shopper hay admin) cÅ©ng Ä‘Æ°á»£c, miá»…n lÃ  láº¥y Ä‘Æ°á»£c input (Ä‘Ã£ tráº£i qua vÃ²ng validate chÆ°a cáº§n biáº¿t cÃ³ error hay khÃ´ng) thÃ¬ Model sáº½ tÆ°Æ¡ng tÃ¡c vá»›i CSDL 
         **** á»Ÿ ASM2 nÃ y credentials cá»§a admin cÃ³ 2 facts lÆ°u trÃªn CSDL: Ten_dang_nhap, Mat_khau (khÃ´ng cáº§n Role nhÆ° dá»± Ã¡n máº«u vÃ¬ á»Ÿ Ä‘Ã¢y cÃ³ cÃ¡c collection khÃ¡c nhau)

         **** nhá»› validation thÃ´ng tin admin nháº­p vÃ o server (thá»© nháº¥t lÃ  cho thÃ´ng tin trÃªn CSDL pháº£i thá»‘ng nháº¥t Ä‘á»‹nh dáº¡ng, thá»© hai lÃ  báº£o máº­t khÃ´ng cho hacker lá»— há»•ng Ä‘á»ƒ khai thÃ¡c)
            ***** npm install --save express-validator âœ”ï¸

            ***** thá»±c hiá»‡n express validation táº¡i táº§ng Router (thÆ° má»¥c routes)
               const {body} =require('express-validator/check'); ğŸ‘‰ body('Ten_dang_nhap') chain, body('Mat_khau') chain 
               body('Ten_dang_nhap')  pháº£i tá»« 6 kÃ½ tá»± trá»Ÿ lÃªn . KhÃ´ng cáº§n hash, mÃ  sáº½ in hoa táº¥t cáº£ khi vÃ o csdl vá»›i body('Ten_dang_nhap').isUppercase().message("ToÃ n bá»™ máº­t kháº©u pháº£i in hoa")
         ****âš ï¸  https://expressjs.com/en/resources/middleware/session.html

         

      âš½ï¸ getLogin  
      *** Login thÃ nh cÃ´ng, thÃ¬ session is established and is managed inside session store lÃ :
         **** MongoStore ğŸ‘‰  http://expressjs-book.com/index.html%3Fp=128.html

         ****  https://expressjs.com/en/resources/middleware/session.html
             //  middleware to test if authenticated
               function isAuthenticated (req, res, next) {
                 if (req.session.user) next()
                 else next('route')
               }
            => nhÆ° váº­y session chá»‰ cáº§n lÆ°u thÃ´ng tin cá»§a ngÆ°á»i dÃ¹ng lÃ   user , khÃ´ng cáº§n isLoggedIn ğŸ˜ƒ

         
      *** 2 lá»±a chá»n  ğŸ‘ˆ Chá»n cáº£ 2 (vÃ¬ Ä‘á» gá»£i Ã½ admin sáº½ Ä‘Äƒng kÃ½ cho tá»«ng ngÆ°á»i, manually nháº­p dá»¯ liá»‡u trá»±c tiáº¿p lÃªn MongoDB, nhÆ°ng 1 ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ tá»± Ä‘Äƒng kÃ½ cho mÃ¬nh)
         **** admin sáº½ add táº¥t cáº£ nhanvien + quanly vÃ o MongoDB  
            ***** nhÆ° trÆ°á»›c kia admin sáº½ postAddProduct vá»›i cÃ¡c thÃ´ng tin required trong Model
         **** Ä‘á»ƒ há» tá»± register  (oh, nhiá»u thÃ´ng tin láº¯m, VD kÃ¨m Role, SP cÃ³ kÃ¨m userId láº¥y tá»« session. GIá»NG NHÆ¯ 1 View nháº­n dá»¯ liá»‡u )
         => admin Ä‘Äƒng kÃ½ thÃ´ng tin cho QL chi nhÃ¡nh, cho há» máº­t kháº©u luÃ´n (lÃºc sau cÃ³ thá»ƒ tá»± Ä‘á»•i láº¡i vá»›i tÃ­nh nÄƒng Reset Password) 
            ***** táº¡o Schema cho QL chi nhÃ¡h
         => QLChi nhÃ¡nh chá»‰ viá»‡c Log in báº±ng username vÃ  password thÃ´i 


      *** getDashboard

   ** Sau khi cÃ³ admin trÃªn MongoDB, tiáº¿p theo admin sáº½ cáº¥p quyá»n truy cáº­p cho quanlychinhanh vá»›i username vÃ  password
   
   âœ… quanlychinhanh
      âš½ï¸ Login,Register âœ”ï¸
      âš½ï¸ Employee Covid 19 âœ”ï¸
      âš½ï¸ Statistics   âœ”ï¸



- Chá»©c nÄƒng:
   ** admin --> /addPersona (thÃªm/xÃ³a nhanvien, thÃªm quanly)

- views  âœ”ï¸
   <%- include('../includes/head.ejs') %>
      <link rel="stylesheet" href="/css/index.css">
      <link rel="stylesheet" href="/css/login.css">
      <link rel="stylesheet" href="/css/footer.css">
      </head>
  
      <body>
         <%- include('../includes/navigation.ejs') %>
         <main>

   => vá»›i cÃ¡ch nÃ y , cho phÃ©p "customize css" style cho tá»«ng "view chunk"

- Don't have an account? <span> <a href= "<%= `/${role}` %>/register" >ğŸ‘‰ Register </a></span>  âœ”ï¸

- YÃªu cáº§u Ä‘Äƒng nháº­p (khÃ´ng cáº§n Ä‘Äƒng kÃ½)
  ** Chá»‰ cÃ³ Ä‘Äƒng nháº­p, khÃ´ng cÃ³ Ä‘Äƒng kÃ½, thÃ´ng tin vá» ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c nháº­p trá»±c tiáº¿p vÃ o database
  ** ÄÄƒng nháº­p xong thÃ¬ quay láº¡i trang trÆ°á»›c Ä‘Ã³, náº¿u khÃ´ng cÃ³ trang trÆ°á»›c Ä‘Ã³ thÃ¬ quay vá» trang chá»§.
  ** Hiá»‡n nÃºt cho phÃ©p Ä‘Äƒng xuáº¥t sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng (vá»›i password vÃ  email)

- Chá»©c nÄƒng logout (hiá»‡n ra sau khi Ä‘Äƒng login thÃ nh cÃ´ng vá»›i email vÃ  password)
  ** nhanvien 
  ** quanly
  ** admin
  