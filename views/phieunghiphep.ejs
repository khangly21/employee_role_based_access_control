<%- include('../views/layouts/khuc_dau.ejs') %>
<%- include('../views/layouts/header.ejs') %> <!-- n·∫øu c√≥ l·ªói Invalid regular expression: missing / ngay t·∫°i http://localhost:3002/ l√† bi·∫øt controller ƒë√£ g·ª≠i thi·∫øu g√¨ ƒë√≥ cho view index-->

<!--Fetching vulnerabilities -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

        <div class="container">
            <h1 style="background-color: rgb(222 234 77); color: rgb(255,255,0);" class="index_title">ƒê∆°n xin ngh·ªâ ph√©p</h1>

            <!--ƒë·ªãnh d·∫°ng CSS th√¥ng ƒëi·ªáp t∆∞∆°ng t·ª± view register v√† login_mobile_w3css-->
            <% if(message){%> 
                <div class="directMessage w3-panel w3-pale-green user-message user-message--error">
                        <%= message  %>
                </div>
            <%}%>

            

            <div style="min-height:100%" class="index_main_section">
                <!--form action="/nhanvien/dangkynghiphep" sau ƒë√≥ res.redirect('/')-->
                <form class="onLeave-form" action="/nhanvien/dangkynghiphep" method="POST">
                    <div class="">
                        <label for="title">Title</label>
                        <input class="w3-text-blue" type="text" name="title" id="title" value="ngh·ªâ l·ªÖ/vi·ªác c√° nh√¢n">
                    </div>
                    <div class="">
                        <label for="annualLeave">S·ªë ng√†y ph√©p nƒÉm (max: 12 ng√†y per year)</label>
                        
                        <input step="0.01" id="annualLeave" class="w3-text-blue"  type="number" name="annualLeave" id="annualLeave" value="<%= nhanvien.annualLeave%>" readonly>
                    </div>
                  
                        <div class="">
                            <!--N·∫øu s·ªë ng√†y annualLeave c√≤n l·∫°i l√† 0 th√¨ th√¥ng b√°o v√† kh√¥ng cho ph√©p ƒëƒÉng k√Ω.-->
                            <label for="annualLeaveHours">S·ªë ng√†y ph√©p nƒÉm c√≤n l·∫°i quy ƒë·ªïi ra gi·ªù </label>
                            <!--k√Ω t·ª± ejs thi·∫øu = l√† kh√¥ng hi·ªÉn th·ªã s·ªë 15-->
                            <!-- ejs kh√¥ng l·ªìng ejs m√† vi·∫øt n·ªëi ti·∫øp nhau-->
                                <input id="annualLeaveHours" class="w3-text-blue"  type="number" name="annualLeave" id="annualLeave" value="<%= so_h_annualLeave%>" readonly>
                        </div>
            
                        <div class="">
                           
                            <label for="date_to_off">Ch·ªçn ng√†y v√† s·ªë gi·ªù t∆∞∆°ng ·ª©ng ƒë·ªÉ ngh·ªâ ph√©p (c√≥ th·ªÉ nhi·ªÅu ng√†y)</label>
                           
                            <div id="fields_unremovable" class="date_fields">
                                <article class="section_removable">
                                    <!--v√¨ sao row col kh√¥ng c√≥ t√°c d·ª•ng??-->

                                    <div class="container">
                                        <div class="row">
                                            <div class="col-sm-3">
                                                <div>Date :</div>
                                                <!--üíänote: trong name c√≥ [] th√¨ trong tr∆∞·ªùng h·ª£p sau: https://stackoverflow.com/questions/42610022/receive-form-data-in-an-array-in-node-js-using-express-->
                                                <!--üíänote: trong value c√≥ [] th√¨ xem appLTV c·ªßa m√¥n NMCNPM-->
                                                <input class="w3-text-orange" type="date" name="date_to_off"   value="" > <!--Note, c√≥ th·ªÉ d√πng type text nh∆∞ https://adnan-tech.com/calculate-difference-between-2-dates-jquery/-->
                                            </div>
                
                                            <div class="col-sm-3">
                                                
                                                <div>Hours :</div>
                                                
                                                <input step="0.01" class="w3-text-blue hours" name="hour_to_off" type="number" min="0" max="8"  value="" > <span style="color:greenyellow">(max:8h)</span> <!--l·∫•y gi√° tr·ªã ng∆∞·ªùi d√πng nh·∫≠p b·∫±ng DOM this.value-->
                                                <!--min max ·ªü ƒë√¢y n·∫øu b·ªã v∆∞·ª£t qua th√¨ s·∫Ω b·ªã browser b√°o l·ªói-->
                                            </div>

                                            
                                            <div class="col-sm-3">
                                                <div>Sum of hours :</div>
                                                <!-- <span id="sum" style="font-weight: bold;background-color:yellow">0</span> th√¨ $("#sum").html(sum.toFixed(2));-->
                                                <input type="number" step="0.01" id="sum" style="font-weight: bold;background-color:yellow" min="0" max="<%= so_h_annualLeave  %>" value="0"/>
                                            </div>

                                            <div class="col-sm-3">
                                                <input class="btn btn-primary" type="button" id="more_fields" onclick="add_fields();" value="Add More" />
                                            </div>
                                        </div>
                                    </div>
                                    
                                </article>
                            </div>
            
                            <br>

                            <div>
                                <!--https://stackoverflow.com/questions/22434586/how-to-input-float-numbers-in-html-form-->
                                <!--https://www.w3docs.com/snippets/javascript/how-to-get-the-value-of-text-input-field-using-javascript.html-->
                                    <label for="offdays">Sum of days based on Sum of hours (b√© h∆°n S·ªë ng√†y ph√©p nƒÉm c√≤n l·∫°i)</label>
                                    <input class="w3-text-grey" type="number" step="0.01" id="registered_offdays" name="offdays" value="" /> <!--do c√≥ th·ªÉ nh·∫≠p s·ªë th·ª±c 1.5 n√™n kh√¥ng c√≥ n√∫t ch·ªçn s·ªë nguy√™n?-->
                                <!--0.01 ch·ªâ l·∫•y 2 ch·ªØ nearest sau th·∫≠p ph√¢n,n·∫øu nh·∫≠p sai l√† √¥ input s·∫Ω b√°o l·ªói-->
                                <!--kh√¥ng c√≥ step 0.01 l√† ph·∫£i vi·∫øt integer -->
                            </div>
            
                      
                        </div>
                
                        <div class="">
                            <label for="reason">L√Ω do</label>
                            <textarea  class="w3-text-pink" name="reason" id="reason" rows="5" value="gi·∫£i quy·∫øt ph√©p nƒÉm">gi·∫£i quy·∫øt ph√©p nƒÉm </textarea> <!--n·∫øu value="gi·∫£i quy·∫øt ph√©p nƒÉm" l√† kh√¥ng c√≥ hi·ªán g√¨ h·∫øt-->
                             <!--n·∫øu c√≥ html tag hay comment ph√≠a sau th√¨ s·∫Ω kh√¥ng ƒë∆∞·ª£c d·ªãch m√† hi·ªán r√µ h6,h4...-->
                        </div>
                        
                        <input type="hidden" name="id_nhanvien" value="<%= nhanvien._id  %>"/>
                       
                        <!--expression in EJS-->
                        <!--thay v√¨ bao ngo√†i HTML tag, c√≤n c√≥ th·ªÉ ƒë·ª©ng b√™n trong-->

                        <!--https://stackoverflow.com/questions/40207912/how-to-use-jquery-with-my-node-js-ejs-template-->
                            <input <%if(nhanvien.annualLeave===0 ){ %> disabled <%  }  %> type="submit" class="btn btn-primary" value="N·ªôp ƒë∆°n ngh·ªâ ph√©p">
                        
                </form>
    
                <!--form-->
            
            </div>
        </div>

        <!--sau khi c√≥ $ th√¨ d√πng trong ƒë√¢y ƒë∆∞·ª£c kh√¥ng? <input <%if(nhanvien.annualLeave===0 ){ %> disabled <%  }  %>-->
<script>
    /*kh√¥ng d√πng ƒë∆∞·ª£c EJS tag trong script nh∆∞ $("#songaynghidangky").val() >  ejs tag's nhanvien.annualLeave */
    $('#registered_offdays').on('change', function () {  //c√°ch 2 l√† d√πng min max tr·ª±c ti·∫øp
        if($(this).val() - $("#annualLeave").val() > 0){
           window.alert("ngay ngh·ªâ ph·∫£i nh·ªè h∆°n hay b·∫±ng annualLeave!"); //test b·∫±ng c√°ch g√µ tr·ª±c ti·∫øp v√†o √¥ 
           $(this).val("0");
        }else{
            // window.alert($(this).val()) //ok
            // window.alert($("#annualLeave").val()) //undefined
            // window.alert("khong co gi") //th√¥ng b√°o n√†y c√≥ khi 16 > undefined th√¨ tr·∫£ v·ªÅ false
        }
    })
    
</script>
<%- include('../views/layouts/khuc_cuoi.ejs') %>